!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){function t(e){return s.raw?e:encodeURIComponent(e)}function n(e){return s.raw?e:decodeURIComponent(e)}function i(e){return t(s.json?JSON.stringify(e):String(e))}function o(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(r," ")),s.json?JSON.parse(e):e}catch(e){}}function a(t,n){var i=s.raw?t:o(t);return e.isFunction(n)?n(i):i}var r=/\+/g,s=e.cookie=function(o,r,l){if(arguments.length>1&&!e.isFunction(r)){if(l=e.extend({},s.defaults,l),"number"==typeof l.expires){var c=l.expires,d=l.expires=new Date;d.setTime(+d+864e5*c)}return document.cookie=[t(o),"=",i(r),l.expires?"; expires="+l.expires.toUTCString():"",l.path?"; path="+l.path:"",l.domain?"; domain="+l.domain:"",l.secure?"; secure":""].join("")}for(var u=o?void 0:{},p=document.cookie?document.cookie.split("; "):[],f=0,h=p.length;f<h;f++){var m=p[f].split("="),v=n(m.shift()),g=m.join("=");if(o&&o===v){u=a(g,r);break}o||void 0===(g=a(g))||(u[v]=g)}return u};s.defaults={},e.removeCookie=function(t,n){return void 0!==e.cookie(t)&&(e.cookie(t,"",e.extend({},n,{expires:-1})),!e.cookie(t))}}),function(e,t,n){function i(e){var t={},i=/^jQuery\d+$/;return n.each(e.attributes,function(e,n){n.specified&&!i.test(n.name)&&(t[n.name]=n.value)}),t}function o(e,i){var o=this,a=n(o);if(o.value==a.attr("placeholder")&&a.hasClass("placeholder"))if(a.data("placeholder-password")){if(a=a.hide().next().show().attr("id",a.removeAttr("id").data("placeholder-id")),!0===e)return a[0].value=i;a.focus()}else o.value="",a.removeClass("placeholder"),o==t.activeElement&&o.select()}function a(){var e,t=this,a=n(t),r=this.id;if(""==t.value){if("password"==t.type){if(!a.data("placeholder-textinput")){try{e=a.clone().attr({type:"text"})}catch(t){e=n("<input>").attr(n.extend(i(this),{type:"text"}))}e.removeAttr("name").data({"placeholder-password":!0,"placeholder-id":r}).bind("focus.placeholder",o),a.data({"placeholder-textinput":e,"placeholder-id":r}).before(e)}a=a.removeAttr("id").hide().prev().attr("id",r).show()}a.addClass("placeholder"),a[0].value=a.attr("placeholder")}else a.removeClass("placeholder")}var r,s,l="placeholder"in t.createElement("input"),c="placeholder"in t.createElement("textarea"),d=n.fn,u=n.valHooks;l&&c?(s=d.placeholder=function(){return this},s.input=s.textarea=!0):(s=d.placeholder=function(){var e=this;return e.filter((l?"textarea":":input")+"[placeholder]").not(".placeholder").bind({"focus.placeholder":o,"blur.placeholder":a}).data("placeholder-enabled",!0).trigger("blur.placeholder"),e},s.input=l,s.textarea=c,r={get:function(e){var t=n(e);return t.data("placeholder-enabled")&&t.hasClass("placeholder")?"":e.value},set:function(e,i){var r=n(e);return r.data("placeholder-enabled")?(""==i?(e.value=i,e!=t.activeElement&&a.call(e)):r.hasClass("placeholder")?o.call(e,!0,i)||(e.value=i):e.value=i,r):e.value=i}},l||(u.input=r),c||(u.textarea=r),n(function(){n(t).delegate("form","submit.placeholder",function(){var e=n(".placeholder",this).each(o);setTimeout(function(){e.each(a)},10)})}),n(e).bind("beforeunload.placeholder",function(){n(".placeholder").each(function(){this.value=""})}),n(function(){n('<style type="text/css">.placeholder { color: #aaa; }</style>').appendTo("head"),n("[placeholder]").placeholder()}))}(this,document,jQuery),function(e){"use strict";function t(t){var n,i=t.attr("data-target")||(n=t.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,"");return e(i)}function n(t){return this.each(function(){var n=e(this),o=n.data("bs.collapse"),a=e.extend({},i.DEFAULTS,n.data(),"object"==typeof t&&t);!o&&a.toggle&&/show|hide/.test(t)&&(a.toggle=!1),o||n.data("bs.collapse",o=new i(this,a)),"string"==typeof t&&o[t]()})}var i=function(t,n){this.$element=e(t),this.options=e.extend({},i.DEFAULTS,n),this.$trigger=e('[data-toggle="collapse"][href="#'+t.id+'"],[data-toggle="collapse"][data-target="#'+t.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};i.VERSION="3.3.4",i.TRANSITION_DURATION=350,i.DEFAULTS={toggle:!0},i.prototype.dimension=function(){return this.$element.hasClass("width")?"width":"height"},i.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var t,o=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(o&&o.length&&(t=o.data("bs.collapse"))&&t.transitioning)){var a=e.Event("show.bs.collapse");if(this.$element.trigger(a),!a.isDefaultPrevented()){o&&o.length&&(n.call(o,"hide"),t||o.data("bs.collapse",null));var r=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[r](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var s=function(){this.$element.removeClass("collapsing").addClass("collapse in")[r](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!e.support.transition)return s.call(this);var l=e.camelCase(["scroll",r].join("-"));this.$element.one("bsTransitionEnd",e.proxy(s,this)).emulateTransitionEnd(i.TRANSITION_DURATION)[r](this.$element[0][l])}}}},i.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var t=e.Event("hide.bs.collapse");if(this.$element.trigger(t),!t.isDefaultPrevented()){var n=this.dimension();this.$element[n](this.$element[n]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var o=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};if(!e.support.transition)return o.call(this);this.$element[n](0).one("bsTransitionEnd",e.proxy(o,this)).emulateTransitionEnd(i.TRANSITION_DURATION)}}},i.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},i.prototype.getParent=function(){return e(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(e.proxy(function(n,i){var o=e(i);this.addAriaAndCollapsedClass(t(o),o)},this)).end()},i.prototype.addAriaAndCollapsedClass=function(e,t){var n=e.hasClass("in");e.attr("aria-expanded",n),t.toggleClass("collapsed",!n).attr("aria-expanded",n)};var o=e.fn.collapse;e.fn.collapse=n,e.fn.collapse.Constructor=i,e.fn.collapse.noConflict=function(){return e.fn.collapse=o,this},e(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(i){var o=e(this);o.attr("data-target")||i.preventDefault();var a=t(o),r=a.data("bs.collapse"),s=r?"toggle":o.data();n.call(a,s)})}(jQuery),function(e){"use strict";function t(t){t&&3===t.which||(e(o).remove(),e(a).each(function(){var i=e(this),o=n(i),a={relatedTarget:this};o.hasClass("open")&&(o.trigger(t=e.Event("hide.bs.dropdown",a)),t.isDefaultPrevented()||(i.attr("aria-expanded","false"),o.removeClass("open").trigger("hidden.bs.dropdown",a)))}))}function n(t){var n=t.attr("data-target");n||(n=t.attr("href"),n=n&&/#[A-Za-z]/.test(n)&&n.replace(/.*(?=#[^\s]*$)/,""));var i=n&&e(n);return i&&i.length?i:t.parent()}function i(t){return this.each(function(){var n=e(this),i=n.data("bs.dropdown");i||n.data("bs.dropdown",i=new r(this)),"string"==typeof t&&i[t].call(n)})}var o=".dropdown-backdrop",a='[data-toggle="dropdown"]',r=function(t){e(t).on("click.bs.dropdown",this.toggle)};r.VERSION="3.3.4",r.prototype.toggle=function(i){var o=e(this);if(!o.is(".disabled, :disabled")){var a=n(o),r=a.hasClass("open");if(t(),!r){"ontouchstart"in document.documentElement&&!a.closest(".navbar-nav").length&&e('<div class="dropdown-backdrop"/>').insertAfter(e(this)).on("click",t);var s={relatedTarget:this};if(a.trigger(i=e.Event("show.bs.dropdown",s)),i.isDefaultPrevented())return;o.trigger("focus").attr("aria-expanded","true"),a.toggleClass("open").trigger("shown.bs.dropdown",s)}return!1}},r.prototype.keydown=function(t){if(/(38|40|27|32)/.test(t.which)&&!/input|textarea/i.test(t.target.tagName)){var i=e(this);if(t.preventDefault(),t.stopPropagation(),!i.is(".disabled, :disabled")){var o=n(i),r=o.hasClass("open");if(!r&&27!=t.which||r&&27==t.which)return 27==t.which&&o.find(a).trigger("focus"),i.trigger("click");var s=" li:not(.disabled):visible a",l=o.find('[role="menu"]'+s+', [role="listbox"]'+s);if(l.length){var c=l.index(t.target);38==t.which&&c>0&&c--,40==t.which&&c<l.length-1&&c++,~c||(c=0),l.eq(c).trigger("focus")}}}};var s=e.fn.dropdown;e.fn.dropdown=i,e.fn.dropdown.Constructor=r,e.fn.dropdown.noConflict=function(){return e.fn.dropdown=s,this},e(document).on("click.bs.dropdown.data-api",t).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",a,r.prototype.toggle).on("keydown.bs.dropdown.data-api",a,r.prototype.keydown).on("keydown.bs.dropdown.data-api",'[role="menu"]',r.prototype.keydown).on("keydown.bs.dropdown.data-api",'[role="listbox"]',r.prototype.keydown)}(jQuery),function(e){"use strict";function t(t,i){return this.each(function(){var o=e(this),a=o.data("bs.modal"),r=e.extend({},n.DEFAULTS,o.data(),"object"==typeof t&&t);a||o.data("bs.modal",a=new n(this,r)),"string"==typeof t?a[t](i):r.show&&a.show(i)})}var n=function(t,n){this.options=n,this.$body=e(document.body),this.$element=e(t),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,e.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};n.VERSION="3.3.4",n.TRANSITION_DURATION=300,n.BACKDROP_TRANSITION_DURATION=150,n.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},n.prototype.toggle=function(e){return this.isShown?this.hide():this.show(e)},n.prototype.show=function(t){var i=this,o=e.Event("show.bs.modal",{relatedTarget:t});this.$element.trigger(o),this.isShown||o.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',e.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){i.$element.one("mouseup.dismiss.bs.modal",function(t){e(t.target).is(i.$element)&&(i.ignoreBackdropClick=!0)})}),this.backdrop(function(){var o=e.support.transition&&i.$element.hasClass("fade");i.$element.parent().length||i.$element.appendTo(i.$body),i.$element.show().scrollTop(0),i.adjustDialog(),o&&i.$element[0].offsetWidth,i.$element.addClass("in").attr("aria-hidden",!1),i.enforceFocus();var a=e.Event("shown.bs.modal",{relatedTarget:t});o?i.$dialog.one("bsTransitionEnd",function(){i.$element.trigger("focus").trigger(a)}).emulateTransitionEnd(n.TRANSITION_DURATION):i.$element.trigger("focus").trigger(a)}))},n.prototype.hide=function(t){t&&t.preventDefault(),t=e.Event("hide.bs.modal"),this.$element.trigger(t),this.isShown&&!t.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),e(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),e.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",e.proxy(this.hideModal,this)).emulateTransitionEnd(n.TRANSITION_DURATION):this.hideModal())},n.prototype.enforceFocus=function(){e(document).off("focusin.bs.modal").on("focusin.bs.modal",e.proxy(function(e){this.$element[0]===e.target||this.$element.has(e.target).length||this.$element.trigger("focus")},this))},n.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",e.proxy(function(e){27==e.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},n.prototype.resize=function(){this.isShown?e(window).on("resize.bs.modal",e.proxy(this.handleUpdate,this)):e(window).off("resize.bs.modal")},n.prototype.hideModal=function(){var e=this;this.$element.hide(),this.backdrop(function(){e.$body.removeClass("modal-open"),e.resetAdjustments(),e.resetScrollbar(),e.$element.trigger("hidden.bs.modal")})},n.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},n.prototype.backdrop=function(t){var i=this,o=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var a=e.support.transition&&o;if(this.$backdrop=e('<div class="modal-backdrop '+o+'" />').appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",e.proxy(function(e){if(this.ignoreBackdropClick)return void(this.ignoreBackdropClick=!1);e.target===e.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide())},this)),a&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!t)return;a?this.$backdrop.one("bsTransitionEnd",t).emulateTransitionEnd(n.BACKDROP_TRANSITION_DURATION):t()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var r=function(){i.removeBackdrop(),t&&t()};e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",r).emulateTransitionEnd(n.BACKDROP_TRANSITION_DURATION):r()}else t&&t()},n.prototype.handleUpdate=function(){this.adjustDialog()},n.prototype.adjustDialog=function(){var e=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&e?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!e?this.scrollbarWidth:""})},n.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},n.prototype.checkScrollbar=function(){var e=window.innerWidth;if(!e){var t=document.documentElement.getBoundingClientRect();e=t.right-Math.abs(t.left)}this.bodyIsOverflowing=document.body.clientWidth<e,this.scrollbarWidth=this.measureScrollbar()},n.prototype.setScrollbar=function(){var e=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing&&this.$body.css("padding-right",e+this.scrollbarWidth)},n.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)},n.prototype.measureScrollbar=function(){var e=document.createElement("div");e.className="modal-scrollbar-measure",this.$body.append(e);var t=e.offsetWidth-e.clientWidth;return this.$body[0].removeChild(e),t};var i=e.fn.modal;e.fn.modal=t,e.fn.modal.Constructor=n,e.fn.modal.noConflict=function(){return e.fn.modal=i,this},e(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(n){var i=e(this),o=i.attr("href"),a=e(i.attr("data-target")||o&&o.replace(/.*(?=#[^\s]+$)/,"")),r=a.data("bs.modal")?"toggle":e.extend({remote:!/#/.test(o)&&o},a.data(),i.data());i.is("a")&&n.preventDefault(),a.one("show.bs.modal",function(e){e.isDefaultPrevented()||a.one("hidden.bs.modal",function(){i.is(":visible")&&i.trigger("focus")})}),t.call(a,r,this)})}(jQuery),function(e){"use strict";function t(t){return this.each(function(){var i=e(this),o=i.data("bs.tab");o||i.data("bs.tab",o=new n(this)),"string"==typeof t&&o[t]()})}var n=function(t){this.element=e(t)};n.VERSION="3.3.4",n.TRANSITION_DURATION=150,n.prototype.show=function(){var t=this.element,n=t.closest("ul:not(.dropdown-menu)"),i=t.data("target");if(i||(i=t.attr("href"),i=i&&i.replace(/.*(?=#[^\s]*$)/,"")),!t.parent("li").hasClass("active")){var o=n.find(".active:last a"),a=e.Event("hide.bs.tab",{relatedTarget:t[0]}),r=e.Event("show.bs.tab",{relatedTarget:o[0]});if(o.trigger(a),t.trigger(r),!r.isDefaultPrevented()&&!a.isDefaultPrevented()){var s=e(i);this.activate(t.closest("li"),n),this.activate(s,s.parent(),function(){o.trigger({type:"hidden.bs.tab",relatedTarget:t[0]}),t.trigger({type:"shown.bs.tab",relatedTarget:o[0]})})}}},n.prototype.activate=function(t,i,o){function a(){r.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),t.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),s?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu").length&&t.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),o&&o()}var r=i.find("> .active"),s=o&&e.support.transition&&(r.length&&r.hasClass("fade")||!!i.find("> .fade").length);r.length&&s?r.one("bsTransitionEnd",a).emulateTransitionEnd(n.TRANSITION_DURATION):a(),r.removeClass("in")};var i=e.fn.tab;e.fn.tab=t,e.fn.tab.Constructor=n,e.fn.tab.noConflict=function(){return e.fn.tab=i,this};var o=function(n){n.preventDefault(),t.call(e(this),"show")};e(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',o).on("click.bs.tab.data-api",'[data-toggle="pill"]',o)}(jQuery),function(e){"use strict";function t(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var n in t)if(void 0!==e.style[n])return{end:t[n]};return!1}e.fn.emulateTransitionEnd=function(t){var n=!1,i=this;e(this).one("bsTransitionEnd",function(){n=!0});var o=function(){n||e(i).trigger(e.support.transition.end)};return setTimeout(o,t),this},e(function(){e.support.transition=t(),e.support.transition&&(e.event.special.bsTransitionEnd={bindType:e.support.transition.end,delegateType:e.support.transition.end,handle:function(t){if(e(t.target).is(this))return t.handleObj.handler.apply(this,arguments)}})})}(jQuery),function(e){"use strict";function t(t){return this.each(function(){var i=e(this),o=i.data("bs.carousel"),a=e.extend({},n.DEFAULTS,i.data(),"object"==typeof t&&t),r="string"==typeof t?t:a.slide;o||i.data("bs.carousel",o=new n(this,a)),"number"==typeof t?o.to(t):r?o[r]():a.interval&&o.pause().cycle()})}var n=function(t,n){this.$element=e(t),this.$indicators=this.$element.find(".carousel-indicators"),this.options=n,this.paused=null,this.sliding=null,this.interval=null,this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",e.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",e.proxy(this.pause,this)).on("mouseleave.bs.carousel",e.proxy(this.cycle,this))};n.VERSION="3.3.4",n.TRANSITION_DURATION=600,n.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},n.prototype.keydown=function(e){if(!/input|textarea/i.test(e.target.tagName)){switch(e.which){case 37:this.prev();break;case 39:this.next();break;default:return}e.preventDefault()}},n.prototype.cycle=function(t){return t||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(e.proxy(this.next,this),this.options.interval)),this},n.prototype.getItemIndex=function(e){return this.$items=e.parent().children(".item"),this.$items.index(e||this.$active)},n.prototype.getItemForDirection=function(e,t){var n=this.getItemIndex(t);if(("prev"==e&&0===n||"next"==e&&n==this.$items.length-1)&&!this.options.wrap)return t;var i="prev"==e?-1:1,o=(n+i)%this.$items.length;return this.$items.eq(o)},n.prototype.to=function(e){var t=this,n=this.getItemIndex(this.$active=this.$element.find(".item.active"));if(!(e>this.$items.length-1||e<0))return this.sliding?this.$element.one("slid.bs.carousel",function(){t.to(e)}):n==e?this.pause().cycle():this.slide(e>n?"next":"prev",this.$items.eq(e))},n.prototype.pause=function(t){return t||(this.paused=!0),this.$element.find(".next, .prev").length&&e.support.transition&&(this.$element.trigger(e.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},n.prototype.next=function(){if(!this.sliding)return this.slide("next")},n.prototype.prev=function(){if(!this.sliding)return this.slide("prev")},n.prototype.slide=function(t,i){var o=this.$element.find(".item.active"),a=i||this.getItemForDirection(t,o),r=this.interval,s="next"==t?"left":"right",l=this;if(a.hasClass("active"))return this.sliding=!1;var c=a[0],d=e.Event("slide.bs.carousel",{relatedTarget:c,direction:s});if(this.$element.trigger(d),!d.isDefaultPrevented()){if(this.sliding=!0,r&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var u=e(this.$indicators.children()[this.getItemIndex(a)]);u&&u.addClass("active")}var p=e.Event("slid.bs.carousel",{relatedTarget:c,direction:s});return e.support.transition&&this.$element.hasClass("slide")?(a.addClass(t),a[0].offsetWidth,o.addClass(s),a.addClass(s),o.one("bsTransitionEnd",function(){a.removeClass([t,s].join(" ")).addClass("active"),o.removeClass(["active",s].join(" ")),l.sliding=!1,setTimeout(function(){l.$element.trigger(p)},0)}).emulateTransitionEnd(n.TRANSITION_DURATION)):(o.removeClass("active"),a.addClass("active"),this.sliding=!1,this.$element.trigger(p)),r&&this.cycle(),this}};var i=e.fn.carousel;e.fn.carousel=t,e.fn.carousel.Constructor=n,e.fn.carousel.noConflict=function(){return e.fn.carousel=i,this};var o=function(n){var i,o=e(this),a=e(o.attr("data-target")||(i=o.attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,""));if(a.hasClass("carousel")){var r=e.extend({},a.data(),o.data()),s=o.attr("data-slide-to");s&&(r.interval=!1),t.call(a,r),s&&a.data("bs.carousel").to(s),n.preventDefault()}};e(document).on("click.bs.carousel.data-api","[data-slide]",o).on("click.bs.carousel.data-api","[data-slide-to]",o),e(window).on("load",function(){e('[data-ride="carousel"]').each(function(){var n=e(this);t.call(n,n.data())})})}(jQuery),function(e){function t(e){if("bug-string-char-index"==e)return"a"!="a"[0];var t,n='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}',i="json"==e;if(i||"json-stringify"==e||"json-parse"==e){if("json-stringify"==e||i){var r=s.stringify,c="function"==typeof r&&l;if(c){(t=function(){return 1}).toJSON=t;try{c="0"===r(0)&&"0"===r(new Number)&&'""'==r(new String)&&r(a)===o&&r(o)===o&&r()===o&&"1"===r(t)&&"[1]"==r([t])&&"[null]"==r([o])&&"null"==r(null)&&"[null,null,null]"==r([o,a,null])&&r({a:[t,!0,!1,null,"\0\b\n\f\r\t"]})==n&&"1"===r(null,t)&&"[\n 1,\n 2\n]"==r([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==r(new Date(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==r(new Date(864e13))&&'"-000001-01-01T00:00:00.000Z"'==r(new Date(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==r(new Date(-1))}catch(e){c=!1}}if(!i)return c}if("json-parse"==e||i){var d=s.parse;if("function"==typeof d)try{if(0===d("0")&&!d(!1)){t=d(n);var u=5==t.a.length&&1===t.a[0];if(u){try{u=!d('"\t"')}catch(e){}if(u)try{u=1!==d("01")}catch(e){}}}}catch(e){u=!1}if(!i)return u}return c&&u}}var n,i,o,a={}.toString,r="function"==typeof define&&define.amd,s="object"==typeof exports&&exports;s||r?"object"==typeof JSON&&JSON?s?(s.stringify=JSON.stringify,s.parse=JSON.parse):s=JSON:r&&(s=e.JSON={}):s=e.JSON||(e.JSON={});var l=new Date(-0xc782b5b800cec);try{l=-109252==l.getUTCFullYear()&&0===l.getUTCMonth()&&1===l.getUTCDate()&&10==l.getUTCHours()&&37==l.getUTCMinutes()&&6==l.getUTCSeconds()&&708==l.getUTCMilliseconds()}catch(e){}if(!t("json")){var c=t("bug-string-char-index");if(!l)var d=Math.floor,u=[0,31,59,90,120,151,181,212,243,273,304,334],p=function(e,t){return u[t]+365*(e-1970)+d((e-1969+(t=+(t>1)))/4)-d((e-1901+t)/100)+d((e-1601+t)/400)};(n={}.hasOwnProperty)||(n=function(e){var t,i={};return(i.__proto__=null,i.__proto__={toString:1},i).toString!=a?n=function(e){var t=this.__proto__,n=e in(this.__proto__=null,this);return this.__proto__=t,n}:(t=i.constructor,n=function(e){var n=(this.constructor||t).prototype;return e in this&&!(e in n&&this[e]===n[e])}),i=null,n.call(this,e)});var f={boolean:1,number:1,string:1,undefined:1},h=function(e,t){var n=typeof e[t];return"object"==n?!!e[t]:!f[n]};if(i=function(e,t){var i,o,r,s,l=0;(i=function(){this.valueOf=0}).prototype.valueOf=0,o=new i;for(r in o)n.call(o,r)&&l++;return i=o=null,l?s=2==l?function(e,t){var i,o={},r="[object Function]"==a.call(e);for(i in e)r&&"prototype"==i||n.call(o,i)||!(o[i]=1)||!n.call(e,i)||t(i)}:function(e,t){var i,o,r="[object Function]"==a.call(e);for(i in e)r&&"prototype"==i||!n.call(e,i)||(o="constructor"===i)||t(i);(o||n.call(e,i="constructor"))&&t(i)}:(o=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],s=function(e,t){var i,r,s="[object Function]"==a.call(e),l=!s&&"function"!=typeof e.constructor&&h(e,"hasOwnProperty")?e.hasOwnProperty:n;for(i in e)s&&"prototype"==i||!l.call(e,i)||t(i);for(r=o.length;i=o[--r];l.call(e,i)&&t(i));}),s(e,t)},!t("json-stringify")){var m={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},v=function(e,t){return("000000"+(t||0)).slice(-e)},g=function(e){var t,n='"',i=0,o=e.length,a=o>10&&c;for(a&&(t=e.split(""));i<o;i++){var r=e.charCodeAt(i);switch(r){case 8:case 9:case 10:case 12:case 13:case 34:case 92:n+=m[r];break;default:if(r<32){n+="\\u00"+v(2,r.toString(16));break}n+=a?t[i]:c?e.charAt(i):e[i]}}return n+'"'},b=function(e,t,r,s,l,c,u){var f,h,m,y,k,w,T,C,x,S,N,_,A,I,D,M,$=t[e];try{$=t[e]}catch(e){}if("object"==typeof $&&$)if("[object Date]"!=(f=a.call($))||n.call($,"toJSON"))"function"==typeof $.toJSON&&("[object Number]"!=f&&"[object String]"!=f&&"[object Array]"!=f||n.call($,"toJSON"))&&($=$.toJSON(e));else if($>-1/0&&$<1/0){if(p){for(y=d($/864e5),h=d(y/365.2425)+1970-1;p(h+1,0)<=y;h++);for(m=d((y-p(h,0))/30.42);p(h,m+1)<=y;m++);y=1+y-p(h,m),k=($%864e5+864e5)%864e5,w=d(k/36e5)%24,T=d(k/6e4)%60,C=d(k/1e3)%60,x=k%1e3}else h=$.getUTCFullYear(),m=$.getUTCMonth(),y=$.getUTCDate(),w=$.getUTCHours(),T=$.getUTCMinutes(),C=$.getUTCSeconds(),x=$.getUTCMilliseconds();$=(h<=0||h>=1e4?(h<0?"-":"+")+v(6,h<0?-h:h):v(4,h))+"-"+v(2,m+1)+"-"+v(2,y)+"T"+v(2,w)+":"+v(2,T)+":"+v(2,C)+"."+v(3,x)+"Z"}else $=null;if(r&&($=r.call(t,e,$)),null===$)return"null";if("[object Boolean]"==(f=a.call($)))return""+$;if("[object Number]"==f)return $>-1/0&&$<1/0?""+$:"null";if("[object String]"==f)return g(""+$);if("object"==typeof $){for(A=u.length;A--;)if(u[A]===$)throw TypeError();if(u.push($),S=[],I=c,c+=l,"[object Array]"==f){for(_=0,A=$.length;_<A;D||(D=!0),_++)N=b(_,$,r,s,l,c,u),S.push(N===o?"null":N);M=D?l?"[\n"+c+S.join(",\n"+c)+"\n"+I+"]":"["+S.join(",")+"]":"[]"}else i(s||$,function(e){var t=b(e,$,r,s,l,c,u);t!==o&&S.push(g(e)+":"+(l?" ":"")+t),D||(D=!0)}),M=D?l?"{\n"+c+S.join(",\n"+c)+"\n"+I+"}":"{"+S.join(",")+"}":"{}";return u.pop(),M}};s.stringify=function(e,t,n){var i,o,r;if("function"==typeof t||"object"==typeof t&&t)if("[object Function]"==a.call(t))o=t;else if("[object Array]"==a.call(t)){r={};for(var s,l=0,c=t.length;l<c;s=t[l++],("[object String]"==a.call(s)||"[object Number]"==a.call(s))&&(r[s]=1));}if(n)if("[object Number]"==a.call(n)){if((n-=n%1)>0)for(i="",n>10&&(n=10);i.length<n;i+=" ");}else"[object String]"==a.call(n)&&(i=n.length<=10?n:n.slice(0,10));return b("",(s={},s[""]=e,s),o,r,i,"",[])}}if(!t("json-parse")){var y,k,w=String.fromCharCode,T={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},C=function(){throw y=k=null,SyntaxError()},x=function(){for(var e,t,n,i,o,a=k,r=a.length;y<r;)switch(o=a.charCodeAt(y)){case 9:case 10:case 13:case 32:y++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=c?a.charAt(y):a[y],y++,e;case 34:for(e="@",y++;y<r;)if((o=a.charCodeAt(y))<32)C();else if(92==o)switch(o=a.charCodeAt(++y)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=T[o],y++;break;case 117:for(t=++y,n=y+4;y<n;y++)(o=a.charCodeAt(y))>=48&&o<=57||o>=97&&o<=102||o>=65&&o<=70||C();e+=w("0x"+a.slice(t,y));break;default:C()}else{if(34==o)break;for(o=a.charCodeAt(y),t=y;o>=32&&92!=o&&34!=o;)o=a.charCodeAt(++y);e+=a.slice(t,y)}if(34==a.charCodeAt(y))return y++,e;C();default:if(t=y,45==o&&(i=!0,o=a.charCodeAt(++y)),o>=48&&o<=57){for(48==o&&(o=a.charCodeAt(y+1))>=48&&o<=57&&C(),i=!1;y<r&&(o=a.charCodeAt(y))>=48&&o<=57;y++);if(46==a.charCodeAt(y)){for(n=++y;n<r&&(o=a.charCodeAt(n))>=48&&o<=57;n++);n==y&&C(),y=n}if(101==(o=a.charCodeAt(y))||69==o){for(o=a.charCodeAt(++y),43!=o&&45!=o||y++,n=y;n<r&&(o=a.charCodeAt(n))>=48&&o<=57;n++);n==y&&C(),y=n}return+a.slice(t,y)}if(i&&C(),"true"==a.slice(y,y+4))return y+=4,!0;if("false"==a.slice(y,y+5))return y+=5,!1;if("null"==a.slice(y,y+4))return y+=4,null;C()}return"$"},S=function(e){var t,n;if("$"==e&&C(),"string"==typeof e){if("@"==(c?e.charAt(0):e[0]))return e.slice(1);if("["==e){for(t=[];"]"!=(e=x());n||(n=!0))n&&(","==e?"]"==(e=x())&&C():C()),","==e&&C(),t.push(S(e));return t}if("{"==e){for(t={};"}"!=(e=x());n||(n=!0))n&&(","==e?"}"==(e=x())&&C():C()),","!=e&&"string"==typeof e&&"@"==(c?e.charAt(0):e[0])&&":"==x()||C(),t[e.slice(1)]=S(x());return t}C()}return e},N=function(e,t,n){var i=_(e,t,n);i===o?delete e[t]:e[t]=i},_=function(e,t,n){var o,r=e[t];if("object"==typeof r&&r)if("[object Array]"==a.call(r))for(o=r.length;o--;)N(r,o,n);else i(r,function(e){N(r,e,n)});return n.call(e,t,r)};s.parse=function(e,t){var n,i;return y=0,k=""+e,n=S(x()),"$"!=x()&&C(),y=k=null,t&&"[object Function]"==a.call(t)?_((i={},i[""]=n,i),"",t):n}}}r&&define(function(){return s})}(this);var NXUTILS=function(){return{formatNumber:function(e,t,n,i,o){if(e<=0)return t;var a=e%100;if(a>=5&&a<=20)return e+o;var r=a%10;return 1==r?e+n:0==r||r>=5?e+o:e+i},formatDate:function(e){if(!this.isValidDate(e))return"";var t=e.getUTCFullYear(),n=e.getUTCMonth()+1,i=e.getUTCDate();return(i<10?"0"+i:i)+"."+(n<10?"0"+n:n)+"."+t},formatSQLDateTimeUTC:function(e){return this.isValidDate(e)?this.zeroPad(e.getUTCFullYear(),4)+"-"+this.zeroPad(e.getUTCMonth()+1,2)+"-"+this.zeroPad(e.getUTCDate(),2)+" "+this.zeroPad(e.getUTCHours(),2)+":"+this.zeroPad(e.getUTCMinutes(),2)+":"+this.zeroPad(e.getUTCSeconds(),2):""},parseDate:function(e){if(!e)return null;if("object"==typeof e&&"getTime"in e)return e;var t=e.split(/\./);return t[0]=parseInt(t[0],10),t[1]=parseInt(t[1],10),t[2]=parseInt(t[2],10),isNaN(t[0])||t[0]<=0||isNaN(t[1])||t[1]<=0||isNaN(t[2])||t[2]<=0?null:new Date(Date.UTC(t[2],t[1]-1,t[0]))},calcAge:function(e,t){var n=this.parseDate(e),i=this.parseDate(t);if(!n||!i)return-1;var o=i.getUTCFullYear()-n.getUTCFullYear();return i.getUTCMonth()<n.getUTCMonth()?o--:i.getUTCMonth()==n.getUTCMonth()&&i.getUTCDate()<n.getUTCDate()&&o--,o},dateAddDays:function(e,t){return e?new Date(e.getTime()+24*t*3600*1e3):null},dateDiffDays:function(e,t){return e&&t?Math.round(Math.abs(t.getTime()-e.getTime())/864e5):0},currentDate:function(){var e=new Date;return new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()))},formatMoney:function(e,t,n){"number"!=typeof e&&(e=parseFloat(e)),isNaN(e)&&(e=0),t=t||0;var i=e.toFixed(t);if(n)for(var o=i.length-(t?4+t:3);o>0;)i=i.substr(0,o)+n+i.substr(o),o-=3;return i},constructModal:function(e,t,n,i,o,a){var r;return r="Foundation"in window?$('<div class="reveal-modal '+n+'">'+(e?"<h2>"+e+"</h2>":"")+t+(o?"":'<a class="close-reveal-modal">&#215;</a>')+"</div>").appendTo(document.body):$('<div class="modal fade"><div class="modal-dialog '+n+'"><div class="modal-content"><div class="modal-header">'+(o?"":'<button type="button" class="close" data-dismiss="modal">&times;</button>')+'<h4 class="modal-title">'+e+'</h4></div><div class="modal-body" style="'+(i||"")+'">'+t+"</div></div>").appendTo(document.body),a&&r.on("closed hidden.bs.modal",function(){r.remove()}),r},openModal:function(e){"Foundation"in window?e.foundation("reveal","open"):e.modal("show")},closeModal:function(e){"Foundation"in window?e.foundation("reveal","close"):e.modal("hide")},openModalIFrame:function(e,t){"number"==typeof t&&(t="height:"+t+"px;");var n=this.constructModal("",'<iframe src="'+e+'" width="100%" height="100%" scrolling="no" frameborder="0"></iframe>',"iframe-dialog",t);this.openModal(n),n.on("closed hidden.bs.modal",function(){console.log("modal closed"),n.remove(),delete window.setPopupHeight
}),window.setPopupHeight=function(e){"Foundation"in window?n.height(e):(n.find(".modal-body").height(e),$(window).trigger("resize"))}},parseQueryString:function(e){return void 0===e&&(e=window.location.search.substr(1)),function(e){if(""==e)return{};for(var t={},n=0;n<e.length;++n){var i=e[n].split("=");2==i.length&&(t[i[0]]=decodeURIComponent(i[1].replace(/\+/g," ")))}return t}(e.split("&"))},parseQueryStringArray:function(e){return void 0===e&&(e=window.location.search.substr(1)),function(e){if(""==e)return[];for(var t=[],n=0;n<e.length;++n){var i=e[n].split("=");2==i.length&&t.push({name:i[0],value:decodeURIComponent(i[1].replace(/\+/g," "))})}return t}(e.split("&"))},noNull:function(e){return null==e?"":e},zeroPad:function(e,t){for(e=e?e.toString():"";e.length<t;)e="0"+e;return e},trim:function(e){return e?String(e).replace(/^\s+/,"").replace(/\s+$/,""):""},isBlank:function(e){return!NXUTILS.trim(e)},escapeHTML:function(e){return e?e.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;"):""},formatDdmmyyyyDate:function(e){return this.isValidDate(e)?this.zeroPad(e.getDate(),2)+"."+this.zeroPad(e.getMonth()+1,2)+"."+this.zeroPad(e.getFullYear(),4):""},formatSQLDate:function(e){return this.isValidDate(e)?this.zeroPad(e.getFullYear(),4)+"-"+this.zeroPad(e.getMonth()+1,2)+"-"+this.zeroPad(e.getDate(),2):""},formatSQLDateTime:function(e){return this.isValidDate(e)?this.zeroPad(e.getFullYear(),4)+"-"+this.zeroPad(e.getMonth()+1,2)+"-"+this.zeroPad(e.getDate(),2)+" "+this.zeroPad(e.getHours(),2)+":"+this.zeroPad(e.getMinutes(),2)+":"+this.zeroPad(e.getSeconds(),2):""},isValidDate:function(e){return e&&e.getTime&&!isNaN(e.getTime())},parseSqlDateTime:function(e){return e?e.match(/^(\d+)-(\d+)-(\d+)\D+(\d+):(\d+):(\d+)/)?new Date(RegExp.$1,RegExp.$2-1,RegExp.$3,RegExp.$4,RegExp.$5,RegExp.$6):e.match(/^(\d+)-(\d+)-(\d+)$/)?new Date(RegExp.$1,RegExp.$2-1,RegExp.$3,0,0,0):e.match(/^(\d+)\.(\d+)\.(\d+)\D+(\d+):(\d+)(?::(\d+))?/)?new Date(RegExp.$3,RegExp.$2-1,RegExp.$1,RegExp.$4,RegExp.$5,RegExp.$6):e.match(/^(\d+)\.(\d+)\.(\d+)$/)?new Date(RegExp.$3,RegExp.$2-1,RegExp.$1,0,0,0):null:null},limitTextLength:function(e,t){if(!e)return"";if(e=this.trim(e),e.length<=t)return this.trim(e);var n=/[a-zа-яёA-ZА-ЯЁ0-9]/i;if(!n.test(e.charAt(t-1))||!n.test(e.charAt(t)))return this.trim(e.substr(0,t));for(var i=t-2;i>2;){if(!n.test(e.charAt(i)))return this.trim(e.substr(0,i+1));i--}return this.trim(e.substr(0,t))},rot13:function(e){return e.replace(/[a-zA-Z]/g,function(e){return String.fromCharCode((e<="Z"?90:122)>=(e=e.charCodeAt(0)+13)?e:e-26)})}}}(),NXCMS=function(){function e(e,t){return window.NXDATA.en?t:e}function t(e){return e=e||"",decodeURIComponent(e.replace(/\+/g," "))}function n(e){return e=t(e),e.length&&'"'==e.charAt(0)&&'"'==e.charAt(e.length-1)&&(e=e.substring(1,e.length-1)),e}function i(){var t=$.cookie("NXlogin");t!==N&&(N=t,t?(C={id:$.cookie("NXuserid"),login:n($.cookie("NXlogin")),name:n($.cookie("NXusername")),opts:n($.cookie("NXuseropts")),picture:n($.cookie("NXuserpic"))},C.manager=!!C.opts.match(/-R[^-]*[AEG]/),C.moderator=!!C.opts.match(/-R[^-]*[AECM]/),C.contributor=!!C.opts.match(/-R[^-]*[AEC]/),C.editor=!!C.opts.match(/-R[^-]*[AE]/),C.admin=!!C.opts.match(/-R[^-]*[A]/),C.special=C.manager||C.moderator||C.contributor||C.editor||C.admin,C.emailVerified=!!C.opts.match(/-EV/),$("#user-login-status").html('<a class="current-user-name" onclick="NXCMS.logoutUser();return false;" href="#">'+NXUTILS.escapeHTML(NXUTILS.limitTextLength(C.name,10))+"</a>"),$("#user-login-dropdown").html('<a class="current-user-name dropdown-toggle" data-toggle="dropdown" href="#">'+NXUTILS.escapeHTML(NXUTILS.limitTextLength(C.name,10))+' <span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/login/out" onclick="NXCMS.logoutUser();return false;">'+e("Выход","Log Out")+"</a></li></ul>")):(C=void 0,$("#user-login-status").html('<a href="#" onclick="NXCMS.openLoginWin();return false;">'+e("Вход","Log In")+"</a>"),$("#user-login-dropdown").html('<a href="/login" class="dropdown-toggle" data-toggle="dropdown">'+e("Вход","Log In")+' <span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/login/google" onclick="NXCMS.openLoginWin(this.href);return false;" target="_blank">'+e("Войти через","Log In via")+' Google</a></li><li><a href="/login/mailru" onclick="NXCMS.openLoginWin(this.href);return false;" target="_blank">'+e("Войти через","Log In via")+' Mail.ru</a></li><li><a href="/login/yandex" onclick="NXCMS.openLoginWin(this.href);return false;" target="_blank">'+e("Войти через Яндекс","Log In via Yandex")+'</a></li><li><a href="/login/facebook" onclick="NXCMS.openLoginWin(this.href);return false;" target="_blank">'+e("Войти через","Log In via")+' Facebook</a></li><li><a href="/login/vk" onclick="NXCMS.openLoginWin(this.href);return false;" target="_blank">'+e("Войти через ВКонтакте","Log In via VK.com")+"</a></li></ul>")),$(window).trigger("userLoginStatusChanged.NXCMS",C),l(),o())}function o(){var t=$("#new-forum-post");if(t.length&&NXDATA.pagesCategory)if(t.empty(),C){var n='<form class="new-forum-post-form">'+(C.picture?'<div class="pic"><img src="'+C.picture+'" /></div>':'<div class="pic no-pic"></div>')+'<div class="h">'+NXUTILS.escapeHTML(C.name)+'</div><div class="t"><input type="text" name="msgTitle" placeholder="'+e("Заголовок новой темы","New topic title")+'"><textarea style="display:none" name="msgText" placeholder="'+e("Подробности","Details")+'..."></textarea></div><div class="b"><button class="button radius small btn btn-default btn-sm" type="submit">'+e("Создать","Create")+'</button><span class="tip">Ctrl+Enter</span></div></form>',i=$(n);i.appendTo(t);var o=null,a=!1;i.on("focus",":input",function(){o&&(clearTimeout(o),o=null),a||(i.find('[name="msgText"]').show().css("height","1px").animate({height:"8em"}),a=!0)}),i.on("blur",":input",function(){o&&(clearTimeout(o),o=null),NXUTILS.isBlank(i.find('[name="msgText"]').val())&&(o=setTimeout(function(){a&&(i.find('[name="msgText"]').hide(),a=!1)},200))}),i.submit(s),i.on("keyup.NXCMS","input,textarea",function(e){e.ctrlKey&&13==e.keyCode&&i.submit()})}else t.append('<div class="login-required">'+e("Чтобы создать новую тему необходимо","To start a new topic please")+' <a href="#" onclick="NXCMS.openLoginWin();return false;">'+e("войти","log in")+"</a>.</div>")}function a(t){this.find(":input").removeAttr("disabled"),t.slug?window.location.href="/forum/"+t.slug:$.notifier.error(e("Ошибка сервера","Server error"))}function r(t){var n=this;if(400==t.status)$.notifier.error(e("Сбой отправки; попробуйте выйти и войти","Post failed; try logging out, then log in"));else if(409==t.status){if(--_>=0)return void p.call(n);_=5,$.notifier.error(e("Сбой передачи данных","Network failure"))}else 403==t.status?$.notifier.error(e("Нет доступа; вероятно вас забанили","Access denied; perhaps you've been banned")):402==t.status?c(n,!1):$.notifier.error(e("Сбой передачи данных","Network failure"));n.find(":input").removeAttr("disabled")}function s(t){t.preventDefault();var n=$(this),i=NXUTILS.trim(n.find('[name="msgTitle"]').val());if(NXUTILS.isBlank(i))return $.notifier.error(e("Введите заголовок новой темы","Please enter topic title")),void n.find('[name="msgTitle"]').focus();var o=NXUTILS.trim(n.find('[name="msgText"]').val());if(NXUTILS.isBlank(o))return $.notifier.error(e("Введите текст сообщения","Please enter message text")),void n.find('[name="msgText"]').focus();n.find(":input").attr("disabled","disabled");var s={msgTitle:i,msgText:o,category:NXDATA.pagesCategory},l="/data/forums";n.data("nx-last-submit",{uri:l,data:s}),$.ajax(l,{type:"POST",data:s,dataType:"json",context:n}).done(a).fail(r)}function l(){if(!S){if(S=$(".comments-section"),!S.length)return;S.on("click.NXCMS",".del",h),S.on("click.NXCMS",".reply",g),S.on("click.NXCMS",".edit",v),S.on("click.NXCMS",".vote-up,.vote-down",m),S.on("keyup.NXCMS",".post-comment-form",function(e){e.ctrlKey&&13==e.keyCode&&$(this).closest(".post-comment-form").submit()})}if(S.length){if(f(),S.find(".post-comment-form").remove(),S.find(".comments-closed").remove(),S.find(".login-required").remove(),NXDATA.commentsClosed)return void(S.find(".comment").length?S.append('<div class="comments-closed">'+e("Прием новых комментариев закрыт","Comments closed")+".</div>"):(S.remove(),S=null));if(C){var t='<form class="post-comment-form">'+(C.picture?'<div class="pic"><img src="'+C.picture+'" /></div>':'<div class="pic no-pic"></div>')+'<div class="h">'+NXUTILS.escapeHTML(C.name)+'</div><div class="t"><textarea name="msgText" placeholder="'+e("Комментарий","Your comment here")+'" class="form-control"></textarea></div><div class="b"><button class="button radius small btn btn-default btn-sm" type="submit">'+e("Отправить","Post")+'</button><span class="tip">Ctrl+Enter</span></div></form>',n=$(t);n.appendTo(S),n.submit(p)}else S.append('<div class="login-required">'+e("Чтобы добавить комментарий необходимо","To add your comment please")+' <a href="#" onclick="NXCMS.openLoginWin();return false;">'+e("войти","log in")+"</a>.</div>")}}function c(t,n){var i=""+Math.round(1e7*Math.random()),o=NXUTILS.constructModal(e("Введите код, указанный на картинке","Please enter code from picture"),'<form><div class="row collapse in"><div class="small-4 columns col-xs-4 i"><img src="/captcha/'+i+'"></div><div class="small-4 columns col-xs-4 c"><input type="text" name="ccode" class="form-control"></div><div class="small-4 columns col-xs-4 b"><input class="postfix button radius btn btn-default btn-sm" type="submit" value="'+e("Ввод","Enter")+'"></div></div></form>',"captcha-dialog small"),s=o.find("form");s.submit(function(e){e.preventDefault();var l=t.data("nx-last-submit");if(l.data.ckey=i,l.data.ccode=NXUTILS.trim(s.find('[name="ccode"]').val()),!l.data.ccode)return void s.find('[name="ccode"]').focus();$.ajax(l.uri,{type:"POST",data:l.data,dataType:"json",context:t}).done(n?d:a).fail(n?u:r),NXUTILS.closeModal(o)}),o.on("closed hidden.bs.modal",function(){o.remove(),console.log("modal removed")}),o.on("opened shown.bs.modal",function(){s.find('[name="ccode"]').focus()}),NXUTILS.openModal(o)}function d(t){var n=this;if(n.find(":input").removeAttr("disabled"),t.commentHtml){var i=n.data("edit-cid"),o=n.data("reply-to-cid");i?n.closest(".comment").replaceWith(t.commentHtml):o?n.replaceWith(t.commentHtml):($(t.commentHtml).insertBefore(n).hide().slideDown(),n.get(0).reset()),f()}else $.notifier.error(e("Ошибка сервера","Server error"))}function u(t){var n=this;if(400==t.status)$.notifier.error(e("Сбой отправки; попробуйте выйти и войти","Post failed; try logging out, then log in"));else if(409==t.status){if(--_>=0)return void p.call(n);_=5,$.notifier.error(e("Сбой передачи данных","Network failure"))}else 403==t.status?$.notifier.error(e("Нет доступа; вероятно вас забанили","Access denied; perhaps you've been banned")):402==t.status?c(n,!0):$.notifier.error(e("Сбой передачи данных","Network failure"));n.find(":input").removeAttr("disabled")}function p(t){t&&t.preventDefault();var n=$(this),i=n.data("edit-cid"),o=n.data("reply-to-cid"),a=NXUTILS.trim(n.find('[name="msgText"]').val());if(NXUTILS.isBlank(a))return $.notifier.error(e("Введите текст комментария","Please enter your comment")),void n.find('[name="msgText"]').focus();n.find(":input").attr("disabled","disabled");var r="/data/comments/"+NXDATA.pageId+(i?"/"+i:""),s={msgText:a};o&&(s.replyTo=o),n.data("nx-last-submit",{uri:r,data:s}),$.ajax(r,{type:"POST",data:s,dataType:"json",context:n}).done(d).fail(u)}function f(){S.find(".comment .edit").remove(),S.find(".comment .reply").remove(),S.find(".comment .del").remove(),C&&!NXDATA.commentsClosed&&S.find(".comment .f").append('<a href="#" class="reply">'+e("Ответить","Reply")+"</a>"),NXCMS.currentUserInRole("M")&&(S.find(".comment").prepend('<div class="del">&times;</div>'),S.find(".comment .f").append('<a href="#" class="edit">'+e("Редактировать","Edit")+"</a>"))}function h(t){if(t.preventDefault(),NXCMS.currentUserInRole("M")){var n=$(t.target).closest(".comment"),i=n.data("cid");(i||"0"===i)&&$.ajax("/data/comments/"+NXDATA.pageId+"/"+i,{type:"POST",data:{delete:!0},dataType:"json"}).done(function(t){""===t.commentHtml?n.slideUp(function(){n.remove()}):$.notifier.error(e("Ошибка: ","Error: ")+JSON.stringify(t))}).fail(function(t){$.notifier.error(e("Ошибка: ","Error: ")+t.status)})}}function m(t){t.preventDefault();var n=$(this),i=n.is(".vote-up")?1:-1,o=parseInt(n.text())||0,a=n.closest(".comment"),r=a.data("cid");if(r||"0"===r){if(ga&&ga("send","event","comment",i>0?"vote-up":"vote-down",NXDATA.pageId,r),!NXCMS.currentUser())return void $.notifier.error(e("Чтобы проголосовать необходимо","In order to vote please")+' <a href="#" onclick="NXCMS.openLoginWin();return false;">'+e("войти","log in")+"</a>");$.ajax("/data/comments/"+NXDATA.pageId+"/"+r,{type:"POST",data:{vote:i},dataType:"json"}).done(function(t){t.error?$.notifier.error(e("Вы уже проголосовали за этот комментарий","You have already voted for this comment")):n.text(o+1)}).fail(function(t){$.notifier.error(e("Ошибка: ","Error: ")+t.status)})}}function v(t){if(t.preventDefault(),C){var n=$(t.target).closest(".comment"),i=n.data("cid");(i||"0"===i)&&$.getJSON("/data/comments/"+NXDATA.pageId+"/"+i).done(function(t){var o='<form class="post-comment-form" data-edit-cid="'+i+'"><div class="t"><textarea name="msgText" placeholder="'+e("Комментарий","Comment text")+'" class="form-control">'+NXUTILS.escapeHTML(t.message_text)+'</textarea></div><div class="b"><button class="button radius small btn btn-default btn-sm" type="submit">'+e("Сохранить","Save")+'</button><span class="tip">Ctrl+Enter</span></div></form>',a=$(o);n.find(">.t").empty().append(a),a.find('[name="msgText"]').focus(),a.submit(p)})}}function g(t){if(t.preventDefault(),C){var n=$(t.target).closest(".comment"),i=n.data("cid");if(i||"0"===i){var o='<form class="post-comment-form" data-reply-to-cid="'+i+'"><div class="h">'+NXUTILS.escapeHTML(C.name)+'</div><div class="t"><textarea name="msgText" placeholder="'+e("Ответ","Your reply")+'" class="form-control"></textarea></div><div class="b"><button class="button radius small btn btn-default btn-sm" type="submit">'+e("Отправить","Post")+'</button><span class="tip">Ctrl+Enter</span></div></form>',a=$(o);a.appendTo(n),a.find('[name="msgText"]').focus(),a.submit(p)}}}function b(t){t.preventDefault();var n=$(this),i=n.is(".vote-up")?1:-1,o=parseInt(n.text())||0,a=n.closest(".page-vote"),r=a.data("pid");if(r){if(ga&&ga("send","event","page",i>0?"vote-up":"vote-down",r),!NXCMS.currentUser())return void $.notifier.error(e("Чтобы проголосовать необходимо","In order to vote please")+' <a href="#" onclick="NXCMS.openLoginWin();return false;">'+e("войти","log in")+"</a>");$.ajax("/data/pages/"+r+"/vote",{type:"POST",data:{vote:i},dataType:"json"}).done(function(t){t.error?$.notifier.error(e("Вы уже проголосовали за эту статью","You have already voted for this article")):n.text(o+1)}).fail(function(t){$.notifier.error(e("Ошибка: ","Error: ")+t.status)})}}function y(e){if(console.log("page stats",e),e&&e.rows&&e.rows.length){var t,n,i,o,a=0,r=["вс","пн","вт","ср","чт","пт","сб"],s="<table>";for(s+="<tr><th>Дата</th><th>#</th></tr>",t=0;t<e.rows.length;t++)(o=parseInt(e.rows[t][1]))&&(n=e.rows[t][0].replace(/(\d{4})(\d{2})(\d{2})/,"$1-$2-$3"),i=NXUTILS.parseSqlDateTime(n).getDay(),a+=o,s+="<tr"+(0==i||6==i?' class="we"':"")+"><td>"+n+" "+r[i]+"</td><td>"+o+"</td></tr>");s+="<tr><th>За 30 дней</th><th>"+a+"</th></tr>",s+="</table>",$("#page-stats").html(s)}}function k(t,n,i){T(e("Сбой","Failure")+": ["+n+"] "+i,"error",!1)}function w(){if(x&&1==x.indexOf("comment-")){var e=$(x);gotoComment(e)}}function T(e,t,n){$.notifier[t](e,n)}window.NXDATA=window.NXDATA||{};var C,x,S,N="refresh",_=5;return window.location.hash&&1==window.location.hash.indexOf("comment-")&&(x=window.location.hash,window.location.hash=""),$(function(){setTimeout(w,200),$("[data-email]").replaceWith(function(){var e=NXUTILS.rot13($(this).data("email"));return'<a href="mailto:'+e+'">'+e+"</a>"}),$(".liame").html(function(){var e=NXUTILS.rot13($.trim($(this).text()));return'<a href="mailto:'+e+'">'+e+"</a>"}),$(document.body).on("click","a.no-click, a.unavailable, .unavailable > a",function(e){e.preventDefault()});var e;$("[data-block-slug]").hover(function(t){if(NXCMS.currentUser()){var n=$(t.target).closest("[data-block-slug]");if(n.length&&n.data("block-slug")){var i=n.data("block-access");i||(i="admin"),NXCMS.currentUserInRole(i)&&(e=$('<div class="block-edit-btn" title="Редактировать блок">&bull;</div>').appendTo(n),e.click(function(){NXCMS.openModalIFrame("/block_editor#/?slug="+n.data("block-slug")+"&elements="+n.data("block-elements"),500)}))}}},function(t){e&&(e.remove(),e=!1)});var t;$(window).on("userLoginStatusChanged.NXCMS",function(){var e;if(C&&C.special&&!window.NXDATA.disableAdminLinks){if(t&&t.remove(),t=$('<div class="page-admin-buttons"/>').appendTo(document.body),C.contributor&&(window.NXDATA.pageId&&$('<a title="Редактировать страницу" target="_blank" href="/page_editor#/?id='+window.NXDATA.pageId+'">&bull;</div>').appendTo(t).click(function(){return NXCMS.openModalIFrame("/page_editor#/?id="+window.NXDATA.pageId,500),!1}),"pageId"in window.NXDATA&&$('<a title="Создать страницу" target="_blank" href="/page_editor">+</a>').appendTo(t)),window.NXDATA.adminLinks)for(e=0;e<window.NXDATA.adminLinks.length;e++){var n=window.NXDATA.adminLinks[e];if(NXCMS.currentUserInRole(n.role)){var i=$('<a title="'+NXUTILS.escapeHTML(n.title)+'" target="_blank" href="'+n.link+'">'+n.label+"</a>").appendTo(t);n.onclick&&i.click(n.onclick)}}if(C.editor){var o=$("#page-stats");o.length&&(o.empty(),$('<button class="button secondary small radius btn btn-default btn-sm">Показать статистику просмотров страницы</button>').click(function(){$.getJSON("/data/ga/by-path",{path:window.location.pathname},y)}).appendTo(o))}}else t&&(t.remove(),t=!1),$("#page-stats").empty()});try{$(".fancybox").fancybox().hoverbutton({width:24,height:24,my:"left bottom",at:"left bottom",offset:"4 -4",html:'<img src="/i/images/zoomin-24x24.png" />'})}catch(e){}$(".page-vote").on("click.NXCMS",".vote-up,.vote-down",b),setInterval(i,1e3),i()}),$.extend({},NXUTILS,{currentUser:function(){return i(),C},currentUserInRole:function(e){return i(),!!C&&(e=e.toLowerCase(),"a"===e||"admin"===e?C.admin:"e"===e||"editor"===e?C.editor:"c"===e||"contributor"===e?C.contributor:"m"===e||"moderator"===e?C.moderator:("g"===e||"manager"===e)&&C.manager)},currentUserIsAdmin:function(){return i(),C&&C.admin},logoutUser:function(){$.ajax({url:"/login/out",dataType:"json",type:"GET",success:i,error:k})},openLoginWin:function(e){e=e||"/login",window.open(e,"NXlogin","width=800,height=500,location=no,status=no,toolbar=no,menubar=no").focus()},openPrivateMessageWin:function(e,t,n){url="/nx/private-message?to="+encodeURIComponent(e)+(t?"&subject="+encodeURIComponent(t):"")+(n?"&message="+encodeURIComponent(n):""),window.open(url,"NXpm","width=650,height=500,location=no,status=no,toolbar=no,menubar=no").focus()},likeComment:function(e){return C?($.ajax({url:"/nx/like-comment",dataType:"json",type:"POST",data:"commentId="+e,success:likeCommentSuccess,error:k}),!1):(NXCMS.openLoginWin(),!1)},likePub:function(e){return C?($.ajax({url:"/nx/like",dataType:"json",type:"POST",data:"pubId="+e,success:likePubSuccess,error:k}),!1):(NXCMS.openLoginWin(),!1)},likeTopic:function(e){return C?($.ajax({url:"/nx/like",dataType:"json",type:"POST",data:"topicId="+e,success:likeTopicSuccess,error:k}),!1):(NXCMS.openLoginWin(),!1)},gotoComment:function(e){gotoComment(e)},editComment:function(e){return postCommentMsgEdit(e)},replyComment:function(e){return postCommentMsgReply(e)},quoteComment:function(e){return postCommentMsgQuote(e)},quoteCommentSenderName:function(e){return postCommentMsgSenderName(e)},replyCommentPrivate:function(e){return postCommentMsgReplyPrivate(e)},postCommentResetEditReply:function(){postCommentResetEditReply()},resetCommentForm:function(){},commentFormReloadCaptcha:function(e){},sortPubs:function(e,t,n){var i=$("#"+e),o=i.children("ul").first();void 0===n&&(n={}),o.children().filter(function(){var e=$(this).attr("ord");return e==t||(!!n[e]||(n[e]=!0,!1))}).remove();var a=o.children().get();if(a.length>0){a.sort(function(e,t){return $(e).attr("ord")>=$(t).attr("ord")?1:-1});for(var r=0;r<a.length;r++)o.prepend(a[r])}else i.hide()}})}();!function(e){function t(t,a,r,s,l){e.isPlainObject(r)?(l=r,r=!1,s=!1):e.isPlainObject(s)&&(l=s,s=!1);var c;return!0===l?o.length>0&&(c=o[o.length-1]):c=l,c||(c={},o.push(c),c.$element=e("<div></div>").appendTo(i)),c.waiting=s,c.$element.html('<a href="" class="close">&times;</a>'+t).removeClass().addClass("notification").addClass(a),setTimeout(function(){c.$element.css({"margin-top":0,opacity:1})},1),c.timeout&&(clearTimeout(c.timeout),c.timeout=!1),r||(c.timeout=setTimeout(function(){n(c)},5e3)),c}function n(t){t&&t.$element&&(t.timeout&&(clearTimeout(t.timeout),t.timeout=!1),t.$element.fadeOut(function(){t.$element.remove(),o.splice(e.inArray(t,o),1),t.$element=null}))}("undefined"==typeof console||!1 in console)&&(window.console={log:function(){}});var i,o=[];e(function(){i=e('<div class="notifier-box"></div>').appendTo(document.body),i.on("click","a.close",function(t){t.preventDefault();var i=e(this).closest(".notification").index();n(o[i])})}),e.notifier={clearAll:function(){var e;for(e=0;e<o.length;e++)n(o[e])},wait:function(e){return t('<i class="loading"></i>'+e,"secondary with-icon",!0,!1)},error:function(e,n,i){return t(e,"alert",n,!1,i)},success:function(e,n,i){return t(e,"success",n,!1,i)},info:function(e,n,i){return t(e,"info",n,!1,i)},neutral:function(e,n,i){return t(e,"secondary",n,!1,i)}}}(jQuery),function(e){("undefined"==typeof console||!1 in console)&&(window.console={log:function(){}}),e(function(){var t=e("#feedback-form"),n=t.find('[name="msgSubj"]'),i=t.find('[name="msgText"]'),o=t.find('[name="msgFrom"]'),a=t.find('[name="ccode"]'),r=t.find(".captcha-image"),s=""+Math.round(1e7*Math.random());r.html('<img src="/captcha/'+s+'">'),t.submit(function(l){l.preventDefault();var c=e.trim(n.val()),d=e.trim(i.val()),u=e.trim(o.val()),p=e.trim(a.val());t.find(":input").prop("disabled",!0),e.notifier.wait("Отправка..."),e.post("/data/messages/feedback",{msgSubj:c,msgText:d,msgFrom:u,ckey:s,ccode:p}).done(function(n){t.find(":input").prop("disabled",!1),n.error?(e.notifier.error(n.error,!1,!0),499==n.errorCode?(r.html('<img src="/captcha/'+s+"?r="+Math.round(1e7*Math.random())+'">'),a.val("").focus()):1==n.errorCode&&i.focus()):(e.notifier.success("Сообщение отправлено",!1,!0),t.get(0).reset(),r.html('<img src="/captcha/'+s+"?r="+Math.round(1e7*Math.random())+'">'))}).fail(function(n){t.find(":input").prop("disabled",!1),e.notifier.error("Сбой отправки",!1,!0)})})})}(jQuery),function(e){("undefined"==typeof console||!1 in console)&&(window.console={log:function(){}}),e.fn.reveal=function(t){function n(){var t=i.filter(function(){var t=e(this);if(!t.is(":hidden")){var n=o.scrollTop(),i=n+o.height(),r=t.offset().top;return r+t.height()>=n-a&&r<=i+a}});t.trigger("reveal"),i=i.not(t)}e.isNumeric(t)&&(t={threshold:t}),t=e.extend(e.fn.reveal.defaults,t||{});var i=this,o=e(window),a=t.threshold;return o.on("scroll.reveal resize.reveal",n),setTimeout(n,100),i},e.fn.reveal.defaults={threshold:0}}(jQuery),function(e){("undefined"==typeof console||!1 in console)&&(window.console={log:function(){}});var t=function(){return"ontouchstart"in window||navigator.maxTouchPoints}();e(function(){e(document).one("touchstart",function(){t=!0})}),e.fn.magnify=function(t){return this.each(function(){function n(e,t){var n=new Image;n.onload=function(){t(n.width,n.height)},n.src=e}function i(){if(s&&(clearTimeout(s),s=!1),!r){r=!0;var i,o,a=l.find("img"),c=a.offset(),p=a.outerWidth(),f=a.outerHeight(),h=d.outerWidth(),m=d.outerHeight(),v=l.attr("href"),g=!1,b=50,y=50;t.maxProjectionHeight&&m>t.maxProjectionHeight&&(m=t.maxProjectionHeight),u.css(d.offset()).css({width:h,height:m}),u.css({backgroundImage:"url(/i/images/wait.gif)",backgroundPosition:"50% 50%"}),u.show(),e(document.body).on("mousemove.magnify",function(e){b=(e.pageX-c.left)/p*100,y=(e.pageY-c.top)/f*100,b<0&&(b=0),b>100&&(b=100),y<0&&(y=0),y>100&&(y=100),g&&(h>=i&&(b=50),m>=o&&(y=50),u.css({backgroundPosition:b+"% "+y+"%"}))}),n(v,function(e,t){i=e,o=t,g=!0,h>=i&&(b=50),m>=o&&(y=50),u.css({backgroundImage:"url("+v+")",backgroundPosition:b+"% "+y+"%"})})}}function o(){s&&clearTimeout(s),s=setTimeout(a,200)}function a(){r=!1,s=!1,e(document.body).off("mousemove.magnify"),u.css({backgroundImage:"none"}),u.hide()}var r,s,l=e(this),c=l.data("magnify-to"),d=c?e(c):l.closest(".magnify-area").length?l.closest(".magnify-area"):l.parent(),u=e('<div class="magnify-overlay"></div>').appendTo(document.body);t.activateByClick||(l.mouseenter(i),u.mouseenter(i),l.mouseleave(o),u.mouseleave(o)),u.click(function(e){l.trigger(e)})})}}(jQuery),function(e){function t(){d.setAttribute("content",f),h=!0}function n(){d.setAttribute("content",p),h=!1}function i(i){c=i.accelerationIncludingGravity,r=Math.abs(c.x),s=Math.abs(c.y),l=Math.abs(c.z),e.orientation&&180!==e.orientation||!(r>7||(l>6&&s<8||l<8&&s>6)&&r>5)?h||t():h&&n()}var o=navigator.userAgent;if(/iPhone|iPad|iPod/.test(navigator.platform)&&/OS [1-5]_[0-9_]* like Mac OS X/i.test(o)&&o.indexOf("AppleWebKit")>-1){var a=e.document;if(a.querySelector){var r,s,l,c,d=a.querySelector("meta[name=viewport]"),u=d&&d.getAttribute("content"),p=u+",maximum-scale=1",f=u+",maximum-scale=10",h=!0;d&&(e.addEventListener("orientationchange",t,!1),e.addEventListener("devicemotion",i,!1))}}}(this),function(e,t,n,i){n.swipebox=function(i,o){var a={useCSS:!0,hideBarsDelay:3e3,isTouch:void 0!==t.createTouch||"ontouchstart"in e||"onmsgesturechange"in e||navigator.msMaxTouchPoints,beforeOpen:null,afterClose:null},r={},s=[],l=!!e.SVGSVGElement;r.settings={},r.init=function(){r.settings=n.extend({},a,o),n.isArray(i)?(s=i,c.target=n(e),c.init(o&&o.startIdx||0)):(i.each(function(){s.push({href:n(this).attr("href"),title:n(this).attr("title")})}),i.click(function(e){e.preventDefault(),e.stopPropagation();var t=i.index(n(this));c.target=n(e.target),c.init(t)}))};var c={init:function(e){r.settings.beforeOpen&&r.settings.beforeOpen(),this.target.trigger("swipebox-start"),n.swipebox.isOpen=!0,this.build(),this.openSlide(e),this.openImg(e),this.preloadImg(e+1),this.preloadImg(e-1)},build:function(){var t=this;if(n("body").append('<div id="swipebox-overlay">\t\t\t\t\t<div id="swipebox-slider"></div>\t\t\t\t\t<div id="swipebox-caption"></div>\t\t\t\t\t<div id="swipebox-action">\t\t\t\t\t\t<a id="swipebox-close"></a>\t\t\t\t\t\t<a id="swipebox-prev"></a>\t\t\t\t\t\t<a id="swipebox-next"></a>\t\t\t\t\t</div>\t\t\t</div>'),t.doCssTrans()&&(n("#swipebox-slider").css({"-webkit-transition":"left 0.4s ease","-moz-transition":"left 0.4s ease","-o-transition":"left 0.4s ease","-khtml-transition":"left 0.4s ease",transition:"left 0.4s ease"}),n("#swipebox-overlay").css({"-webkit-transition":"opacity 1s ease","-moz-transition":"opacity 1s ease","-o-transition":"opacity 1s ease","-khtml-transition":"opacity 1s ease",transition:"opacity 1s ease"}),n("#swipebox-action, #swipebox-caption").css({"-webkit-transition":"0.5s","-moz-transition":"0.5s","-o-transition":"0.5s","-khtml-transition":"0.5s",transition:"0.5s"})),l){var i=n("#swipebox-close").css("background-image");i=i.replace("png","svg"),n("#swipebox-action #swipebox-prev,#swipebox-action #swipebox-next,#swipebox-close").css({"background-image":i})}n.each(s,function(){n("#swipebox-slider").append('<div class="slide"></div>')}),t.setDim(),t.actions(),t.keyboard(),t.gesture(),t.animBars(),n(e).resize(function(){t.setDim()}).resize()},setDim:function(){},supportTransition:function(){for(var e="transition WebkitTransition MozTransition OTransition msTransition KhtmlTransition".split(" "),n=0;n<e.length;n++)if(void 0!==t.createElement("div").style[e[n]])return e[n];return!1},doCssTrans:function(){if(r.settings.useCSS&&this.supportTransition())return!0},gesture:function(){if(r.settings.isTouch){var e=this,t=null,i={},o={},a=n("#swipebox-caption, #swipebox-action");a.addClass("visible-bars"),e.setTimeout(),n("body").bind("touchstart",function(e){return n(this).addClass("touching"),o=e.originalEvent.targetTouches[0],i.pageX=e.originalEvent.targetTouches[0].pageX,n(".touching").bind("touchmove",function(e){e.preventDefault(),e.stopPropagation(),o=e.originalEvent.targetTouches[0]}),!1}).bind("touchend",function(r){r.preventDefault(),r.stopPropagation(),t=o.pageX-i.pageX,t>=10?e.getPrev():t<=-10?e.getNext():a.hasClass("visible-bars")?(e.clearTimeout(),e.hideBars()):(e.showBars(),e.setTimeout()),n(".touching").off("touchmove").removeClass("touching")})}},setTimeout:function(){if(r.settings.hideBarsDelay>0){var t=this;t.clearTimeout(),t.timeout=e.setTimeout(function(){t.hideBars()},r.settings.hideBarsDelay)}},clearTimeout:function(){e.clearTimeout(this.timeout),this.timeout=null},showBars:function(){var e=n("#swipebox-caption, #swipebox-action");this.doCssTrans()?e.addClass("visible-bars"):(n("#swipebox-caption").animate({top:0},500),n("#swipebox-action").animate({bottom:0},500),setTimeout(function(){e.addClass("visible-bars")},1e3))},hideBars:function(){var e=n("#swipebox-caption, #swipebox-action");this.doCssTrans()?e.removeClass("visible-bars"):(n("#swipebox-caption").animate({top:"-50px"},500),n("#swipebox-action").animate({bottom:"-50px"},500),setTimeout(function(){e.removeClass("visible-bars")},1e3))},animBars:function(){var e=this,t=n("#swipebox-caption, #swipebox-action");t.addClass("visible-bars"),e.setTimeout(),n("#swipebox-slider").on("click",function(i){n(i.target).is("img")?t.hasClass("visible-bars")||(e.showBars(),e.setTimeout()):e.closeSlide()}),n("#swipebox-slider").on("mousemove",function(n){t.hasClass("visible-bars")||(e.showBars(),e.setTimeout())}),n("#swipebox-action").hover(function(){e.showBars(),t.addClass("force-visible-bars"),e.clearTimeout()},function(){t.removeClass("force-visible-bars"),e.setTimeout()})},keyboard:function(){var t=this;n(e).bind("keyup",function(e){e.preventDefault(),e.stopPropagation(),37==e.keyCode?t.getPrev():39==e.keyCode?t.getNext():27==e.keyCode&&t.closeSlide()})},actions:function(){var e=this;s.length<2?n("#swipebox-prev, #swipebox-next").hide():(n("#swipebox-prev").bind("click touchend",function(t){t.preventDefault(),t.stopPropagation(),e.getPrev(),e.setTimeout()}),n("#swipebox-next").bind("click touchend",function(t){t.preventDefault(),t.stopPropagation(),e.getNext(),e.setTimeout()})),n("#swipebox-close").bind("click touchend",function(t){e.closeSlide()})},setSlide:function(e,t){t=t||!1;var i=n("#swipebox-slider");this.doCssTrans()?i.css({left:100*-e+"%"}):i.animate({left:100*-e+"%"}),n("#swipebox-slider .slide").removeClass("current"),n("#swipebox-slider .slide").eq(e).addClass("current"),this.setTitle(e),t&&i.fadeIn(),n("#swipebox-prev, #swipebox-next").removeClass("disabled"),0==e?n("#swipebox-prev").addClass("disabled"):e==s.length-1&&n("#swipebox-next").addClass("disabled")},openSlide:function(t){n("html").addClass("swipebox"),n(e).trigger("resize"),this.setSlide(t,!0)},preloadImg:function(e){var t=this;setTimeout(function(){t.openImg(e)},1e3)},openImg:function(e){var t=this;if(e<0||e>=s.length)return!1;t.loadImg(s[e].href,function(){n("#swipebox-slider .slide").eq(e).html(this)})},setTitle:function(e,t){n("#swipebox-caption").empty(),s[e].title&&n("#swipebox-caption").append(s[e].title)},loadImg:function(e,t){var i=n("<img>").on("load",function(){t.call(i)});i.attr("src",e)},getNext:function(){var e=this;index=n("#swipebox-slider .slide").index(n("#swipebox-slider .slide.current")),index+1<s.length?(index++,e.setSlide(index),e.preloadImg(index+1)):(n("#swipebox-slider").addClass("rightSpring"),setTimeout(function(){
n("#swipebox-slider").removeClass("rightSpring")},500))},getPrev:function(){var e=this;index=n("#swipebox-slider .slide").index(n("#swipebox-slider .slide.current")),index>0?(index--,e.setSlide(index),e.preloadImg(index-1)):(n("#swipebox-slider").addClass("leftSpring"),setTimeout(function(){n("#swipebox-slider").removeClass("leftSpring")},500))},closeSlide:function(){var t=this;n(e).trigger("resize"),n("html").removeClass("swipebox"),t.destroy()},destroy:function(){var t=this;n(e).unbind("keyup"),n("body").unbind("touchstart"),n("body").unbind("touchmove"),n("body").unbind("touchend"),n("#swipebox-slider").unbind(),n("#swipebox-overlay").remove(),t.target.trigger("swipebox-destroy"),n.swipebox.isOpen=!1,r.settings.afterClose&&r.settings.afterClose()}};return r.init(),r},n.fn.swipebox=function(e){if(!n.data(this,"_swipebox")){var t=n.swipebox(this,e);this.data("_swipebox",t)}}}(window,document,jQuery),function(e){function t(e){var t=document.createElement("input"),e="on"+e,n=e in t;return n||(t.setAttribute(e,"return;"),n="function"==typeof t[e]),t=null,n}function n(t,i,o){var a=o.aliases[t];return!!a&&(a.alias&&n(a.alias,void 0,o),e.extend(!0,o,a),e.extend(!0,o,i),!0)}function i(t){function n(n){t.numericInput&&(n=n.split("").reverse().join(""));var i=!1,o=0,a=t.greedy,r=t.repeat;"*"==r&&(a=!1),1==n.length&&0==a&&0!=r&&(t.placeholder="");for(var s=e.map(n.split(""),function(e,n){var a=[];if(e==t.escapeChar)i=!0;else if(e!=t.optionalmarker.start&&e!=t.optionalmarker.end||i){var r=t.definitions[e];if(r&&!i)for(var s=0;s<r.cardinality;s++)a.push(t.placeholder.charAt((o+s)%t.placeholder.length));else a.push(e),i=!1;return o+=a.length,a}}),l=s.slice(),c=1;c<r&&a;c++)l=l.concat(s.slice());return{mask:l,repeat:r,greedy:a}}function i(n){t.numericInput&&(n=n.split("").reverse().join(""));var i=!1,o=!1,a=!1;return e.map(n.split(""),function(e,n){var r=[];if(e==t.escapeChar)o=!0;else if(e!=t.optionalmarker.start||o){if(e!=t.optionalmarker.end||o){var s=t.definitions[e];if(s&&!o){for(var l=s.prevalidator,c=l?l.length:0,d=1;d<s.cardinality;d++){var u=c>=d?l[d-1]:[],p=u.validator,f=u.cardinality;r.push({fn:p?"string"==typeof p?new RegExp(p):new function(){this.test=p}:new RegExp("."),cardinality:f||1,optionality:i,newBlockMarker:1==i&&a,offset:0,casing:s.casing,def:s.definitionSymbol||e}),1==i&&(a=!1)}r.push({fn:s.validator?"string"==typeof s.validator?new RegExp(s.validator):new function(){this.test=s.validator}:new RegExp("."),cardinality:s.cardinality,optionality:i,newBlockMarker:a,offset:0,casing:s.casing,def:s.definitionSymbol||e})}else r.push({fn:null,cardinality:0,optionality:i,newBlockMarker:a,offset:0,casing:null,def:e}),o=!1;return a=!1,r}i=!1,a=!0}else i=!0,a=!0})}function o(e){return t.optionalmarker.start+e+t.optionalmarker.end}function a(e){for(var n=0,i=0,o=e.length,a=0;a<o&&(e.charAt(a)==t.optionalmarker.start&&n++,e.charAt(a)==t.optionalmarker.end&&i++,!(n>0&&n==i));a++);var r=[e.substring(0,a)];return a<o&&r.push(e.substring(a+1,o)),r}function r(e){for(var n=e.length,i=0;i<n&&e.charAt(i)!=t.optionalmarker.start;i++);var o=[e.substring(0,i)];return i<n&&o.push(e.substring(i+1,n)),o}function s(t,d,u){var p,f,h=a(d),m=r(h[0]);m.length>1?(p=t+m[0]+o(m[1])+(h.length>1?h[1]:""),-1==e.inArray(p,c)&&""!=p&&(c.push(p),f=n(p),l.push({mask:p,_buffer:f.mask,buffer:f.mask.slice(),tests:i(p),lastValidPosition:-1,greedy:f.greedy,repeat:f.repeat,metadata:u})),p=t+m[0]+(h.length>1?h[1]:""),-1==e.inArray(p,c)&&""!=p&&(c.push(p),f=n(p),l.push({mask:p,_buffer:f.mask,buffer:f.mask.slice(),tests:i(p),lastValidPosition:-1,greedy:f.greedy,repeat:f.repeat,metadata:u})),r(m[1]).length>1&&s(t+m[0],m[1]+h[1],u),h.length>1&&r(h[1]).length>1&&(s(t+m[0]+o(m[1]),h[1],u),s(t+m[0],h[1],u))):(p=t+h,-1==e.inArray(p,c)&&""!=p&&(c.push(p),f=n(p),l.push({mask:p,_buffer:f.mask,buffer:f.mask.slice(),tests:i(p),lastValidPosition:-1,greedy:f.greedy,repeat:f.repeat,metadata:u})))}var l=[],c=[];return e.isFunction(t.mask)&&(t.mask=t.mask.call(this,t)),e.isArray(t.mask)?e.each(t.mask,function(e,t){void 0!=t.mask?s("",t.mask.toString(),t):s("",t.toString())}):s("",t.mask.toString()),t.greedy?l:l.sort(function(e,t){return e.mask.length-t.mask.length})}function o(t,n,i,o){function u(){return t[n]}function p(){return u().tests}function f(){return u()._buffer}function h(){return u().buffer}function m(o,a,r){function s(e,t,n,o){for(var a=b(e),r=n?1:0,s="",l=t.buffer,c=t.tests[a].cardinality;c>r;c--)s+=C(l,a-(c-1));return n&&(s+=n),null!=t.tests[a].fn?t.tests[a].fn.test(s,l,e,o,i):(n==C(t._buffer.slice(),e,!0)||n==i.skipOptionalPartCharacter)&&{refresh:!0,c:C(t._buffer.slice(),e,!0),pos:e}}if(r=!0===r){var l=s(o,u(),a,r);return!0===l&&(l={pos:o}),l}var c=[],l=!1,d=n,p=h().slice(),f=u().lastValidPosition,m=(w(o),[]);return e.each(t,function(e,t){if("object"==typeof t){n=e;var i,v=o,b=u().lastValidPosition;if(b==f){if(v-f>1)for(var w=-1==b?0:b;w<v&&!1!==(i=s(w,u(),p[w],!0));w++){T(h(),w,p[w],!0),!0===i&&(i={pos:w});var C=i.pos||w;u().lastValidPosition<C&&(u().lastValidPosition=C)}if(!g(v)&&!s(v,u(),a,r)){for(var x=k(v)-v,S=0;S<x&&!1===s(++v,u(),a,r);S++);m.push(n)}}if((u().lastValidPosition>=f||n==d)&&v>=0&&v<y()){if(!1!==(l=s(v,u(),a,r))){!0===l&&(l={pos:v});var C=l.pos||v;u().lastValidPosition<C&&(u().lastValidPosition=C)}c.push({activeMasksetIndex:e,result:l})}}}),n=d,function(n,i){var r=!1;if(e.each(i,function(t,i){if(r=-1==e.inArray(i.activeMasksetIndex,n)&&!1!==i.result)return!1}),r)i=e.map(i,function(i,o){if(-1==e.inArray(i.activeMasksetIndex,n))return i;t[i.activeMasksetIndex].lastValidPosition=f});else{var l,c=-1,d=-1;e.each(i,function(t,i){-1!=e.inArray(i.activeMasksetIndex,n)&&!1!==i.result&(-1==c||c>i.result.pos)&&(c=i.result.pos,d=i.activeMasksetIndex)}),i=e.map(i,function(i,r){if(-1!=e.inArray(i.activeMasksetIndex,n)){if(i.result.pos==c)return i;if(!1!==i.result){for(var u=o;u<c;u++){if(!1===(l=s(u,t[i.activeMasksetIndex],t[d].buffer[u],!0))){t[i.activeMasksetIndex].lastValidPosition=c-1;break}T(t[i.activeMasksetIndex].buffer,u,t[d].buffer[u],!0),t[i.activeMasksetIndex].lastValidPosition=u}return l=s(c,t[i.activeMasksetIndex],a,!0),!1!==l&&(T(t[i.activeMasksetIndex].buffer,c,a,!0),t[i.activeMasksetIndex].lastValidPosition=c),i}}})}return i}(m,c)}function v(){var i=n,o={activeMasksetIndex:0,lastValidPosition:-1,next:-1};e.each(t,function(e,t){"object"==typeof t&&(n=e,u().lastValidPosition>o.lastValidPosition?(o.activeMasksetIndex=e,o.lastValidPosition=u().lastValidPosition,o.next=k(u().lastValidPosition)):u().lastValidPosition==o.lastValidPosition&&(-1==o.next||o.next>k(u().lastValidPosition))&&(o.activeMasksetIndex=e,o.lastValidPosition=u().lastValidPosition,o.next=k(u().lastValidPosition)))}),n=-1!=o.lastValidPosition&&t[i].lastValidPosition==o.lastValidPosition?i:o.activeMasksetIndex,i!=n&&(N(h(),k(o.lastValidPosition),y()),u().writeOutBuffer=!0),G.data("_inputmask").activeMasksetIndex=n}function g(e){var t=b(e),n=p()[t];return void 0!=n&&n.fn}function b(e){return e%p().length}function y(){return i.getMaskLength(f(),u().greedy,u().repeat,h(),i)}function k(e){var t=y();if(e>=t)return t;for(var n=e;++n<t&&!g(n););return n}function w(e){var t=e;if(t<=0)return 0;for(;--t>0&&!g(t););return t}function T(e,t,n,i){i&&(t=x(e,t));var o=p()[b(t)],a=n;if(void 0!=a&&void 0!=o)switch(o.casing){case"upper":a=n.toUpperCase();break;case"lower":a=n.toLowerCase()}e[t]=a}function C(e,t,n){return n&&(t=x(e,t)),e[t]}function x(e,t){for(var n;void 0==e[t]&&e.length<y();)for(n=0;void 0!==f()[n];)e.push(f()[n++]);return t}function S(e,t,n){e._valueSet(t.join("")),void 0!=n&&j(e,n)}function N(e,t,n,i){for(var o=t,a=y();o<n&&o<a;o++)!0===i?g(o)||T(e,o,""):T(e,o,C(f().slice(),o,!0))}function _(e,t){var n=b(t);T(e,t,C(f(),n))}function A(e){return i.placeholder.charAt(e%i.placeholder.length)}function I(i,o,a,r,s){var l=void 0!=r?r.slice():M(i._valueGet()).split("");e.each(t,function(e,t){"object"==typeof t&&(t.buffer=t._buffer.slice(),t.lastValidPosition=-1,t.p=-1)}),!0!==a&&(n=0),o&&i._valueSet("");y();e.each(l,function(t,n){if(!0===s){var r=u().p,l=-1==r?r:w(r),c=-1==l?t:k(l);-1==e.inArray(n,f().slice(l+1,c))&&F.call(i,void 0,!0,n.charCodeAt(0),o,a,t)}else F.call(i,void 0,!0,n.charCodeAt(0),o,a,t),a=a||t>0&&t>u().p}),!0===a&&-1!=u().p&&(u().lastValidPosition=w(u().p))}function D(t){return e.inputmask.escapeRegex.call(this,t)}function M(e){return e.replace(new RegExp("("+D(f().join(""))+")*$"),"")}function $(e){for(var t,n,i=h(),o=i.slice(),n=o.length-1;n>=0;n--){var t=b(n);if(!p()[t].optionality)break;if(g(n)&&m(n,i[n],!0))break;o.pop()}S(e,o)}function P(e){if(W&&"number"==typeof e&&(!i.greedy||""!=i.placeholder)){e=h().length-e}return e}function j(t,n,o){var a,r=t.jquery&&t.length>0?t[0]:t;if("number"!=typeof n)return e(t).is(":visible")?(r.setSelectionRange?(n=r.selectionStart,o=r.selectionEnd):document.selection&&document.selection.createRange&&(a=document.selection.createRange(),n=0-a.duplicate().moveStart("character",-1e5),o=n+a.text.length),n=P(n),o=P(o),{begin:n,end:o}):{begin:0,end:0};n=P(n),o=P(o),e(r).is(":visible")&&(o="number"==typeof o?o:n,r.scrollLeft=r.scrollWidth,0==i.insertMode&&n==o&&o++,r.setSelectionRange?(r.selectionStart=n,r.selectionEnd=s?n:o):r.createTextRange&&(a=r.createTextRange(),a.collapse(!0),a.moveEnd("character",o),a.moveStart("character",n),a.select()))}function X(o){if("*"!=i.repeat){var a=!1,r=0,s=n;return e.each(t,function(e,t){if("object"==typeof t){n=e;var i=w(y());if(t.lastValidPosition>=r&&t.lastValidPosition==i){for(var s=!0,l=0;l<=i;l++){var c=g(l),d=b(l);if(c&&(void 0==o[l]||o[l]==A(l))||!c&&o[l]!=f()[d]){s=!1;break}}if(a=a||s)return!1}r=t.lastValidPosition}}),n=s,a}}function L(e,t){return W?e-t>1||e-t==1&&i.insertMode:t-e>1||t-e==1&&i.insertMode}function U(t){var n=e._data(t).events;e.each(n,function(t,n){e.each(n,function(e,t){if("inputmask"==t.namespace&&"setvalue"!=t.type){var n=t.handler;t.handler=function(e){if(!this.readOnly&&!this.disabled)return n.apply(this,arguments);e.preventDefault}}})})}function E(t){var n;if(Object.getOwnPropertyDescriptor&&(n=Object.getOwnPropertyDescriptor(t,"value")),n&&n.get){if(!t._valueGet){var i=n.get,o=n.set;t._valueGet=function(){return W?i.call(this).split("").reverse().join(""):i.call(this)},t._valueSet=function(e){o.call(this,W?e.split("").reverse().join(""):e)},Object.defineProperty(t,"value",{get:function(){var t=e(this),n=e(this).data("_inputmask"),o=n.masksets,a=n.activeMasksetIndex;return n&&n.opts.autoUnmask?t.inputmask("unmaskedvalue"):i.call(this)!=o[a]._buffer.join("")?i.call(this):""},set:function(t){o.call(this,t),e(this).triggerHandler("setvalue.inputmask")}})}}else if(document.__lookupGetter__&&t.__lookupGetter__("value")){if(!t._valueGet){var i=t.__lookupGetter__("value"),o=t.__lookupSetter__("value");t._valueGet=function(){return W?i.call(this).split("").reverse().join(""):i.call(this)},t._valueSet=function(e){o.call(this,W?e.split("").reverse().join(""):e)},t.__defineGetter__("value",function(){var t=e(this),n=e(this).data("_inputmask"),o=n.masksets,a=n.activeMasksetIndex;return n&&n.opts.autoUnmask?t.inputmask("unmaskedvalue"):i.call(this)!=o[a]._buffer.join("")?i.call(this):""}),t.__defineSetter__("value",function(t){o.call(this,t),e(this).triggerHandler("setvalue.inputmask")})}}else t._valueGet||(t._valueGet=function(){return W?this.value.split("").reverse().join(""):this.value},t._valueSet=function(e){this.value=W?e.split("").reverse().join(""):e}),function(t){if(void 0==e.valHooks[t]||1!=e.valHooks[t].inputmaskpatch){var n=e.valHooks[t]&&e.valHooks[t].get?e.valHooks[t].get:function(e){return e.value},i=e.valHooks[t]&&e.valHooks[t].set?e.valHooks[t].set:function(e,t){return e.value=t,e};e.valHooks[t]={get:function(t){var i=e(t);if(i.data("_inputmask")){if(i.data("_inputmask").opts.autoUnmask)return i.inputmask("unmaskedvalue");var o=n(t),a=i.data("_inputmask");return o!=a.masksets[a.activeMasksetIndex]._buffer.join("")?o:""}return n(t)},set:function(t,n){var o=e(t),a=i(t,n);return o.data("_inputmask")&&o.triggerHandler("setvalue.inputmask"),a},inputmaskpatch:!0}}}(t.type)}function O(e,t,n,i){var o=h();if(!1!==i)for(;!g(e)&&e-1>=0;)e--;for(var a=e;a<t&&a<y();a++)if(g(a)){_(o,a);var r=k(a),s=C(o,r);if(s!=A(r))if(r<y()&&!1!==m(a,s,!0)&&p()[b(a)].def==p()[b(r)].def)T(o,a,s,!0);else if(g(a))break}else _(o,a);if(void 0!=n&&T(o,w(t),n),0==u().greedy){var l=M(o.join("")).split("");o.length=l.length;for(var a=0,c=o.length;a<c;a++)o[a]=l[a];0==o.length&&(u().buffer=f().slice())}return e}function R(e,t,n){var i=h();if(C(i,e,!0)!=A(e))for(var o=w(t);o>e&&o>=0;o--)if(g(o)){var a=w(o),r=C(i,a);r!=A(a)&&!1!==m(a,r,!0)&&p()[b(o)].def==p()[b(a)].def&&(T(i,o,r,!0),_(i,a))}else _(i,o);void 0!=n&&C(i,e)==A(e)&&T(i,e,n);var s=i.length;if(0==u().greedy){var l=M(i.join("")).split("");i.length=l.length;for(var o=0,c=i.length;o<c;o++)i[o]=l[o];0==i.length&&(u().buffer=f().slice())}return t-(s-i.length)}function V(e,t,n){if(i.numericInput||W){switch(t){case i.keyCode.BACKSPACE:t=i.keyCode.DELETE;break;case i.keyCode.DELETE:t=i.keyCode.BACKSPACE}if(W){var o=n.end;n.end=n.begin,n.begin=o}}var a=!0;if(n.begin==n.end){var r=t==i.keyCode.BACKSPACE?n.begin-1:n.begin;i.isNumeric&&""!=i.radixPoint&&h()[r]==i.radixPoint&&(n.begin=h().length-1==r?n.begin:t==i.keyCode.BACKSPACE?r:k(r),n.end=n.begin),a=!1,t==i.keyCode.BACKSPACE?n.begin--:t==i.keyCode.DELETE&&n.end++}else n.end-n.begin!=1||i.insertMode||(a=!1,t==i.keyCode.BACKSPACE&&n.begin--);N(h(),n.begin,n.end);var s=y();if(0==i.greedy)O(n.begin,s,void 0,!W&&t==i.keyCode.BACKSPACE&&!a);else{for(var l=n.begin,c=n.begin;c<n.end;c++)!g(c)&&a||(l=O(n.begin,s,void 0,!W&&t==i.keyCode.BACKSPACE&&!a));a||(n.begin=l)}var d=k(-1);N(h(),n.begin,n.end,!0),I(e,!1,!1,h()),u().lastValidPosition<d?(u().lastValidPosition=-1,u().p=d):u().p=n.begin}function B(t){K=!1;var n=this,o=e(n),a=t.keyCode,s=j(n);a==i.keyCode.BACKSPACE||a==i.keyCode.DELETE||r&&127==a||t.ctrlKey&&88==a?(t.preventDefault(),88==a&&(J=h().join("")),V(n,a,s),v(),S(n,h(),u().p),n._valueGet()==f().join("")&&o.trigger("cleared"),i.showTooltip&&o.prop("title",u().mask)):a==i.keyCode.END||a==i.keyCode.PAGE_DOWN?setTimeout(function(){var e=k(u().lastValidPosition);i.insertMode||e!=y()||t.shiftKey||e--,j(n,t.shiftKey?s.begin:e,e)},0):a==i.keyCode.HOME&&!t.shiftKey||a==i.keyCode.PAGE_UP?j(n,0,t.shiftKey?s.begin:0):a==i.keyCode.ESCAPE||90==a&&t.ctrlKey?(I(n,!0,!1,J.split("")),o.click()):a!=i.keyCode.INSERT||t.shiftKey||t.ctrlKey?0!=i.insertMode||t.shiftKey||(a==i.keyCode.RIGHT?setTimeout(function(){var e=j(n);j(n,e.begin)},0):a==i.keyCode.LEFT&&setTimeout(function(){var e=j(n);j(n,e.begin-1)},0)):(i.insertMode=!i.insertMode,j(n,i.insertMode||s.begin!=y()?s.begin:s.begin-1));var l=j(n);!0===i.onKeyDown.call(this,t,h(),i)&&j(n,l.begin,l.end),Y=-1!=e.inArray(a,i.ignorables)}function F(o,a,r,s,l,c){if(void 0==r&&K)return!1;K=!0;var d=this,p=e(d);o=o||window.event;var r=a?r:o.which||o.charCode||o.keyCode;if(!(!0===a||o.ctrlKey&&o.altKey)&&(o.ctrlKey||o.metaKey||Y))return!0;if(r){!0!==a&&46==r&&0==o.shiftKey&&","==i.radixPoint&&(r=44);var f,g,b,x=String.fromCharCode(r);if(a){var N=l?c:u().lastValidPosition+1;f={begin:N,end:N}}else f=j(d);var _=L(f.begin,f.end),I=n;_&&(e.each(t,function(e,t){"object"==typeof t&&(n=e,u().undoBuffer=h().join(""))}),n=I,V(d,i.keyCode.DELETE,f),i.insertMode||e.each(t,function(e,t){"object"==typeof t&&(n=e,R(f.begin,y()),u().lastValidPosition=k(u().lastValidPosition))}),n=I);var D=h().join("").indexOf(i.radixPoint);i.isNumeric&&!0!==a&&-1!=D&&(i.greedy&&f.begin<=D?(f.begin=w(f.begin),f.end=f.begin):x==i.radixPoint&&(f.begin=D,f.end=f.begin));var M=f.begin;g=m(M,x,l),!0===l&&(g=[{activeMasksetIndex:n,result:g}]);var $=-1;if(e.each(g,function(e,t){n=t.activeMasksetIndex,u().writeOutBuffer=!0;var o=t.result;if(!1!==o){var a=!1,r=h();if(!0!==o&&(a=o.refresh,M=void 0!=o.pos?o.pos:M,x=void 0!=o.c?o.c:x),!0!==a){if(1==i.insertMode){for(var s=y(),c=r.slice();C(c,s,!0)!=A(s)&&s>=M;)s=0==s?-1:w(s);if(s>=M){R(M,y(),x);var d=u().lastValidPosition,p=k(d);p!=y()&&d>=M&&C(h().slice(),p,!0)!=A(p)&&(u().lastValidPosition=p)}else u().writeOutBuffer=!1}else T(r,M,x,!0);(-1==$||$>k(M))&&($=k(M))}else if(!l){var f=M<y()?M+1:M;(-1==$||$>f)&&($=f)}$>u().p&&(u().p=$)}}),!0!==l&&(n=I,v()),!1!==s&&(e.each(g,function(e,t){if(t.activeMasksetIndex==n)return b=t,!1}),void 0!=b)){var P=this;if(setTimeout(function(){i.onKeyValidation.call(P,b.result,i)},0),u().writeOutBuffer&&!1!==b.result){var U,E=h();U=a?void 0:i.numericInput?M>D?w($):x==i.radixPoint?$-1:w($-1):$,S(d,E,U),!0!==a&&setTimeout(function(){!0===X(E)&&p.trigger("complete"),Q=!0,p.trigger("input")},0)}else _&&(u().buffer=u().undoBuffer.split(""))}i.showTooltip&&p.prop("title",u().mask),o&&(o.preventDefault?o.preventDefault():o.returnValue=!1)}}function H(t){var n=e(this),o=this,a=t.keyCode,r=h();i.onKeyUp.call(this,t,r,i),a==i.keyCode.TAB&&i.showMaskOnFocus&&(n.hasClass("focus.inputmask")&&0==o._valueGet().length?(r=f().slice(),S(o,r),j(o,0),J=h().join("")):(S(o,r),r.join("")==f().join("")&&-1!=e.inArray(i.radixPoint,r)?(j(o,P(0)),n.click()):j(o,P(0),P(y()))))}function q(t){if(!0===Q&&"input"==t.type)return Q=!1,!0;var n=this,o=e(n);if("propertychange"==t.type&&n._valueGet().length<=y())return!0;setTimeout(function(){var e=void 0!=i.onBeforePaste?i.onBeforePaste.call(n,n._valueGet(),i):n._valueGet();I(n,!1,!1,e.split(""),!0),S(n,h()),!0===X(h())&&o.trigger("complete"),o.click()},0)}function z(t){var n=this,o=e(n),a=j(n),r=n._valueGet();h().length-r.length!=1||r.charAt(a.begin)==h()[a.begin]||r.charAt(a.begin+1)==h()[a.begin]||g(a.begin)?(I(n,!1,!1),S(n,h()),!0===X(h())&&o.trigger("complete"),o.click()):(t.keyCode=i.keyCode.BACKSPACE,B.call(n,t)),t.preventDefault()}var G,W=!1,J=h().join(""),K=!1,Q=!1,Y=!1;if(void 0!=o)switch(o.action){case"isComplete":return X(o.buffer);case"unmaskedvalue":return W=o.$input.data("_inputmask").isRTL,function(t,n){if(!p()||!0!==n&&t.hasClass("hasDatepicker"))return t[0]._valueGet();var o=e.map(h(),function(e,t){return g(t)&&m(t,e,!0)?e:null}),a=(W?o.reverse():o).join("");return void 0!=i.onUnMask?i.onUnMask.call(t,h().join(""),a,i):a}(o.$input,o.skipDatepickerCheck);case"mask":!function(o){if(G=e(o),G.is(":input")){if(G.data("_inputmask",{masksets:t,activeMasksetIndex:n,opts:i,isRTL:!1}),i.showTooltip&&G.prop("title",u().mask),u().greedy=u().greedy?u().greedy:0==u().repeat,null!=G.attr("maxLength")){var r=G.prop("maxLength");r>-1&&e.each(t,function(e,t){"object"==typeof t&&"*"==t.repeat&&(t.repeat=r)}),y()>=r&&r>-1&&(r<f().length&&(f().length=r),0==u().greedy&&(u().repeat=Math.round(r/f().length)),G.prop("maxLength",2*y()))}if(E(o),i.numericInput&&(i.isNumeric=i.numericInput),("rtl"==o.dir||i.numericInput&&i.rightAlignNumerics||i.isNumeric&&i.rightAlignNumerics)&&G.css("text-align","right"),"rtl"==o.dir||i.numericInput){o.dir="ltr",G.removeAttr("dir");var p=G.data("_inputmask");p.isRTL=!0,G.data("_inputmask",p),W=!0}G.unbind(".inputmask"),G.removeClass("focus.inputmask"),G.closest("form").bind("submit",function(){J!=h().join("")&&G.change()}).bind("reset",function(){setTimeout(function(){G.trigger("setvalue")},0)}),G.bind("mouseenter.inputmask",function(){var t=e(this),n=this;!t.hasClass("focus.inputmask")&&i.showMaskOnHover&&n._valueGet()!=h().join("")&&S(n,h())}).bind("blur.inputmask",function(){var o=e(this),a=this,r=a._valueGet(),s=h();o.removeClass("focus.inputmask"),J!=h().join("")&&o.change(),i.clearMaskOnLostFocus&&""!=r&&(r==f().join("")?a._valueSet(""):$(a)),!1===X(s)&&(o.trigger("incomplete"),i.clearIncomplete&&(e.each(t,function(e,t){"object"==typeof t&&(t.buffer=t._buffer.slice(),t.lastValidPosition=-1)}),n=0,i.clearMaskOnLostFocus?a._valueSet(""):(s=f().slice(),S(a,s))))}).bind("focus.inputmask",function(){var t=e(this),n=this,o=n._valueGet();i.showMaskOnFocus&&!t.hasClass("focus.inputmask")&&(!i.showMaskOnHover||i.showMaskOnHover&&""==o)&&n._valueGet()!=h().join("")&&S(n,h(),k(u().lastValidPosition)),t.addClass("focus.inputmask"),J=h().join("")}).bind("mouseleave.inputmask",function(){var t=e(this),n=this;i.clearMaskOnLostFocus&&(t.hasClass("focus.inputmask")||n._valueGet()==t.attr("placeholder")||(n._valueGet()==f().join("")||""==n._valueGet()?n._valueSet(""):$(n)))}).bind("click.inputmask",function(){var t=this;setTimeout(function(){var n=j(t),o=h();if(n.begin==n.end){var a,r=W?P(n.begin):n.begin,s=u().lastValidPosition;a=i.isNumeric&&!1===i.skipRadixDance&&""!=i.radixPoint&&-1!=e.inArray(i.radixPoint,o)?i.numericInput?k(e.inArray(i.radixPoint,o)):e.inArray(i.radixPoint,o):k(s),r<a?g(r)?j(t,r):j(t,k(r)):j(t,a)}},0)}).bind("dblclick.inputmask",function(){var e=this;setTimeout(function(){j(e,0,k(u().lastValidPosition))},0)}).bind(d+".inputmask dragdrop.inputmask drop.inputmask",q).bind("setvalue.inputmask",function(){var e=this;I(e,!0),J=h().join(""),e._valueGet()==f().join("")&&e._valueSet("")}).bind("complete.inputmask",i.oncomplete).bind("incomplete.inputmask",i.onincomplete).bind("cleared.inputmask",i.oncleared),G.bind("keydown.inputmask",B).bind("keypress.inputmask",F).bind("keyup.inputmask",H),(s||c||l)&&(G.unbind("keydown.inputmask",B).unbind("keypress.inputmask",F).unbind("keyup.inputmask",H),"input"==d&&G.unbind(d+".inputmask"),G.bind("input.inputmask",z)),a&&G.bind("input.inputmask",q),I(o,!0,!1,(void 0!=i.onBeforeMask?i.onBeforeMask.call(o,o._valueGet(),i):o._valueGet()).split("")),J=h().join("");var m;try{m=document.activeElement}catch(e){}m===o?(G.addClass("focus.inputmask"),j(o,k(u().lastValidPosition))):i.clearMaskOnLostFocus?h().join("")==f().join("")?o._valueSet(""):$(o):S(o,h()),U(o)}}(o.el);break;case"format":return G=e({}),G.data("_inputmask",{masksets:t,activeMasksetIndex:n,opts:i,isRTL:i.numericInput}),i.numericInput&&(i.isNumeric=i.numericInput,W=!0),I(G,!1,!1,o.value.split(""),!0),h().join("");case"isValid":return G=e({}),G.data("_inputmask",{masksets:t,activeMasksetIndex:n,opts:i,isRTL:i.numericInput}),i.numericInput&&(i.isNumeric=i.numericInput,W=!0),I(G,!1,!0,o.value.split("")),X(h())}}if(void 0===e.fn.inputmask){var a="function"==typeof ScriptEngineMajorVersion?ScriptEngineMajorVersion():new Function("/*@cc_on return @_jscript_version; @*/")()>=10,r=null!==navigator.userAgent.match(new RegExp("iphone","i")),s=null!==navigator.userAgent.match(new RegExp("android.*safari.*","i")),l=null!==navigator.userAgent.match(new RegExp("android.*chrome.*","i")),c=null!==navigator.userAgent.match(new RegExp("android.*firefox.*","i")),d=t("paste")?"paste":t("input")?"input":"propertychange";e.inputmask={defaults:{placeholder:"_",optionalmarker:{start:"[",end:"]"},quantifiermarker:{start:"{",end:"}"},groupmarker:{start:"(",end:")"},escapeChar:"\\",mask:null,oncomplete:e.noop,onincomplete:e.noop,oncleared:e.noop,repeat:0,greedy:!0,autoUnmask:!1,clearMaskOnLostFocus:!0,insertMode:!0,clearIncomplete:!1,aliases:{},onKeyUp:e.noop,onKeyDown:e.noop,onBeforeMask:void 0,onBeforePaste:void 0,onUnMask:void 0,showMaskOnFocus:!0,showMaskOnHover:!0,onKeyValidation:e.noop,skipOptionalPartCharacter:" ",showTooltip:!1,numericInput:!1,isNumeric:!1,radixPoint:"",skipRadixDance:!1,rightAlignNumerics:!0,definitions:{9:{validator:"[0-9]",cardinality:1,definitionSymbol:"*"},a:{validator:"[A-Za-zА-яЁё]",cardinality:1,definitionSymbol:"*"},"*":{validator:"[A-Za-zА-яЁё0-9]",cardinality:1}},keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91},ignorables:[8,9,13,19,27,33,34,35,36,37,38,39,40,45,46,93,112,113,114,115,116,117,118,119,120,121,122,123],getMaskLength:function(e,t,n,i,o){var a=e.length;return t||("*"==n?a=i.length+1:n>1&&(a+=e.length*(n-1))),a}},escapeRegex:function(e){var t=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];return e.replace(new RegExp("(\\"+t.join("|\\")+")","gim"),"\\$1")},format:function(t,a){var r=e.extend(!0,{},e.inputmask.defaults,a);return n(r.alias,a,r),o(i(r),0,r,{action:"format",value:t})},isValid:function(t,a){var r=e.extend(!0,{},e.inputmask.defaults,a);return n(r.alias,a,r),o(i(r),0,r,{action:"isValid",value:t})}},e.fn.inputmask=function(t,a){var r,s=e.extend(!0,{},e.inputmask.defaults,a),l=0;if("string"==typeof t)switch(t){case"mask":return n(s.alias,a,s),r=i(s),0==r.length?this:this.each(function(){o(e.extend(!0,{},r),0,s,{action:"mask",el:this})});case"unmaskedvalue":var c=e(this);return c.data("_inputmask")?(r=c.data("_inputmask").masksets,l=c.data("_inputmask").activeMasksetIndex,s=c.data("_inputmask").opts,o(r,l,s,{action:"unmaskedvalue",$input:c})):c.val();case"remove":return this.each(function(){var t=e(this),n=this;if(t.data("_inputmask")){r=t.data("_inputmask").masksets,l=t.data("_inputmask").activeMasksetIndex,s=t.data("_inputmask").opts,n._valueSet(o(r,l,s,{action:"unmaskedvalue",$input:t,skipDatepickerCheck:!0})),t.removeData("_inputmask"),t.unbind(".inputmask"),t.removeClass("focus.inputmask");var i;Object.getOwnPropertyDescriptor&&(i=Object.getOwnPropertyDescriptor(n,"value")),i&&i.get?n._valueGet&&Object.defineProperty(n,"value",{get:n._valueGet,set:n._valueSet}):document.__lookupGetter__&&n.__lookupGetter__("value")&&n._valueGet&&(n.__defineGetter__("value",n._valueGet),n.__defineSetter__("value",n._valueSet));try{delete n._valueGet,delete n._valueSet}catch(e){n._valueGet=void 0,n._valueSet=void 0}}});case"getemptymask":return this.data("_inputmask")?(r=this.data("_inputmask").masksets,l=this.data("_inputmask").activeMasksetIndex,r[l]._buffer.join("")):"";case"hasMaskedValue":return!!this.data("_inputmask")&&!this.data("_inputmask").opts.autoUnmask;case"isComplete":return r=this.data("_inputmask").masksets,l=this.data("_inputmask").activeMasksetIndex,s=this.data("_inputmask").opts,o(r,l,s,{action:"isComplete",buffer:this[0]._valueGet().split("")});case"getmetadata":return this.data("_inputmask")?(r=this.data("_inputmask").masksets,l=this.data("_inputmask").activeMasksetIndex,r[l].metadata):void 0;default:return n(t,a,s)||(s.mask=t),r=i(s),0==r.length?this:this.each(function(){o(e.extend(!0,{},r),l,s,{action:"mask",el:this})})}else{if("object"==typeof t)return s=e.extend(!0,{},e.inputmask.defaults,t),n(s.alias,t,s),r=i(s),0==r.length?this:this.each(function(){o(e.extend(!0,{},r),l,s,{action:"mask",el:this})});if(void 0==t)return this.each(function(){var t=e(this).attr("data-inputmask");if(t&&""!=t)try{t=t.replace(new RegExp("'","g"),'"');var i=e.parseJSON("{"+t+"}");e.extend(!0,i,a),s=e.extend(!0,{},e.inputmask.defaults,i),n(s.alias,i,s),s.alias=void 0,e(this).inputmask(s)}catch(e){}})}}}}(jQuery),function(e){function t(t){C&&(clearTimeout(C),C=!1),e(".pnavbar .ddwn-menu").hide(),t.is(".ddwn-menu")||(t=t.closest(".ddwn").find(".ddwn-menu")),t.show()}function n(){C=setTimeout(function(){e(".pnavbar .ddwn-menu").hide(),C=!1},100)}function i(e){e.preventDefault();var t=NXCMS.currentUserInRole("editor"),n='<form action="/data/shop-csv/safe" method="post" enctype="multipart/form-data" target="shop-csv-results"><input type="file" name="csv-file" multiple>'+(t?'<label><input type="checkbox" name="safe" checked> Безопасный режим</label>':"")+'</form><iframe id="shop-csv-results" name="shop-csv-results"></iframe>',i=NXUTILS.constructModal("Загрузка CSV",n,"shop-csv-upload-dialog",null,!1,!0),o=i.find("[name=csv-file]");NXUTILS.openModal(i),o.change(function(){var e=i.find("form"),t=i.find("[name=safe]").is(":checked"),n=i.find("[name=replace_pics]").is(":checked"),o=[];t&&o.push("safe"),n&&o.push("replace_pics"),e.attr("action","/data/shop-csv/"+o.join("-")),e.get(0).submit(),setTimeout(function(){i.find("form").get(0).reset()},1e3)})}function o(t){t.preventDefault();var n=NXUTILS.constructModal("Сообщить об ошибке в характеристиках",'<form><div class="form-group"><label for="inputCharacteristics">Пояснения</label><textarea name="comment" class="form-control" id="inputCharacteristics" placeholder="В чем состоит ошибка"></textarea></div><button type="submit" class="subm btn btn-success">Отправить</button></form>',"characteristics-error-dialog",null,!1,!0),i=n.find("[name=comment]");NXUTILS.openModal(n),n.submit(function(t){t.preventDefault();var o=e.trim(i.val());if(!o)return e.notifier.error("Опишите, пожалуйста, в чем состоит ошибка"),void i.focus();var a={uri:location.href,comment:o};e.ajax("/data/characteristics-notify",{data:JSON.stringify(a),contentType:"application/json",type:"POST"}).done(function(e){NXUTILS.closeModal(n)}).fail(function(){e.notifier.error("Сбой передачи данных",!1,!0)})})}function a(){var t=NXDATA&&NXDATA.shopProductId,n=e.cookie("uTrID"),i=e.cookie("uTrPV"),o=i?i.split(/[,-]/):[],a=e.cookie("uTrFAV"),r=a?a.split(/[,-]/):[],l=e.cookie("uTrFV")||NXUTILS.formatSQLDateTime(new Date),c={expires:3650,path:"/"};if(n||(n=s(),e.cookie("uTrID",n,c),e.cookie("uTrFV",l,c)),t&&e.inArray(t,o)<0&&(o.unshift(t),e.cookie("uTrPV",o.slice(0,16).join("-"),c),o.length>1)){var d={_id:n,product_views:o,favorites:r,first_visit:l};e.ajax("/data/track",{data:JSON.stringify(d),contentType:"application/json",type:"POST"})}}function r(){function t(){var t=e.cookie("uTrFAV");return t?t.split(/[,-]/):[]}function n(){if(e.cookie("uTrFAV")!==a){a=e.cookie("uTrFAV");var n=t();r.each(function(){var t=e(this),i=""+(t.closest("[data-upid]").data("upid")||NXDATA.shopProductId),o=e.inArray(i,n);t.text(o>=0?"В избранном":"Добавить в избранное")}),e(".user-favorites").toggleClass("non-empty",n.length>0).html("Избранное"+(n.length?' <span class="badge">'+n.length+"</span>":""))}}function i(i,o){var a=t(),r={expires:3650,path:"/"};i+="";var s=e.inArray(i,a);s>=0?a.splice(s,1):o&&a.unshift(i),e.cookie("uTrFAV",a.slice(0,32).join("-"),r),n()}var o,a,r=e(".action-add-to-favorites"),s=e(".favorite-products-list");n(),setInterval(n,1e3),r.click(function(t){t.preventDefault(),i(e(this).closest("[data-upid]").data("upid")||NXDATA.shopProductId,!0)}),s.on("mouseenter",".product-thumb",function(){o&&o.remove();var t=e(this);o=e('<button class="action-remove-favorite btn btn-default">Удалить из избранного</button>').appendTo(t),o.click(function(){i(t.data("upid")+""),t.remove(),o=null,s.is(":empty")&&s.html('<p class="empty-result">Вы можете поместить любой товар в избранное, с помощью ссылки "Добавить в избранное" на странице товара.</p>')})}).on("mouseleave",".product-thumb",function(){o&&o.remove(),o=null})}function s(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)})}function l(){function t(){for(var e,t=[];t.length<5&&(e=i.shift());)s[e.link]||(s[e.link]=!0,t.push(e));return t}function n(t,n){var i='<ul class="'+t+'">';return e.each(n,function(e,t){i+='<li><a href="'+t.link+'">',t.pic?i+='<img src="'+t.pic+'">':i+='<span class="no-pic"></span>',i+='<span class="title">'+t.title+"</span>",i+='<span class="price">'+t.price+"</span>",i+="</a></li>"}),i+="</ul>"}for(var i=[],o=e(".also-purchased"),a=e(".recommeded-products"),r=e(".also-viewed"),s={},l=3;l>0;l--)NXDATA["similarProducts"+l]&&(i=i.concat(c(NXDATA["similarProducts"+l])));s[location.pathname]=!0,i.length&&o.length?e(n("see-also-products",t())).appendTo(o):o.remove(),a.on("reveal",function(){var o=a.data("key");o?e.getJSON("/blocks/similar-products/"+o+"?ajax=Y").then(function(o){console.log("similar-products",o),o&&o.length&&(i=c(o).concat(i)),i.length?e(n("see-also-products",t())).appendTo(a):a.remove()}):i.length?e(n("see-also-products",t())).appendTo(a):a.remove()}).reveal(500),r.on("reveal",function(){e.getJSON("/data/also-viewed/"+NXDATA.shopProductId).then(function(t){t&&t.length?e(n("see-also-products",c(t).slice(0,5))).appendTo(r):r.remove()})}).reveal(500)}function c(e){for(var t,n,i=e.length;i;t=Math.floor(Math.random()*i),n=e[--i],e[i]=e[t],e[t]=n);return e}function d(){function t(){
e(window).width()<1240?n.addClass("disabled"):(n.removeClass("disabled"),n.css("left",(e(window).width()-1e3)/2-120))}var n=e('<div id="scroll-to-top-btn"></div>').appendTo(document.body),i=!1,o=!1;e(window).resize(t),t(),e(window).scroll(function(){e(this).scrollTop()>160?i||(i=!0,o&&(n.stop(),o=!1),n.animate({opacity:1,bottom:"60px"},800)):o||(o=!0,i&&(n.stop(),i=!1),n.animate({opacity:0,bottom:"-60px"},800))}),n.click(function(){return e("body,html").animate({scrollTop:0},800),!1})}function u(){setInterval(function(){var t=e("#ya-phone").html(),n=e(".shop-primary-contacts .phone"),i=n.html();t&&t!=i&&(console.log("phone substitute",t,"over",i),n.replaceWith('<a href="tel:'+t.replace(/[^\+0-9]/g,"")+'" class="phone">'+t+"</a>"))},100)}function p(){function t(t,i){ga("send","pageview","/site-search-page?search="+encodeURIComponent(t)),e.getJSON("/data/shop-product-search",{q:t,html:"y",page:i||0}).done(function(e){o=e.page||0,e.html?(o?r.find(">ul").append(e.html):(r.html('<ul class="shop-products-list shop-products-search-results">'+e.html+"</ul>"),s.show().text("Мы нашли "+NXUTILS.formatNumber(e.num_results,"-"," товар"," товара"," товаров"))),n(r)):o||(r.html('<p class="empty-result">Ничего не найдено. Попробуйте смягчить критерии поиска.</p>'),s.hide()),l.toggle(!!e.more)})}function n(t){t.find(".render-as-stars").not(".stars-rendered").each(function(){var t,n=e(this),i=parseInt(n.text()),o="";for(t=0;t<5;t++)o+=t<i?'<s class="h"></s>':"<s></s>";n.addClass("star-control-stars stars-rendered").html(o)})}var i,o,a=e(".shop-search-form"),r=e(".shop-category-list-holder"),s=e(".shop-category-list-nav"),l=e(".shop-search-show-more"),c=a.find("[name=search]"),d=e.trim(NXUTILS.parseQueryString().q);a.length&&(s.hide(),a.submit(function(n){n.preventDefault();var a=e.trim(c.val());if(!a)return e.notifier.error("Введите текст для поиска"),void c.focus();a!==i&&(i=a,o=0,l.hide(),r.html('<p class="empty-result">Ждите...</p>'),t(a,0))}),l.click(function(){i&&(l.hide(),t(i,o+1))}),d&&(c.val(d),i=d,r.html('<p class="empty-result">Ждите...</p>'),t(d)))}function f(){function t(t){t.preventDefault();var n=e(this),i=n.data("product"),o=NXUTILS.constructModal("Уведомить о появлении товара",'<form><div class="input-fields"><div class="form-group"><label for="inputEmail">Введите ваш email</label><input type="text" name="email" class="form-control" id="inputEmail" placeholder=""></div><div class="form-group"><label for="inputPhone">и/или номер телефона (для SMS)</label><input type="text" name="phone" class="form-control" id="inputPhone" placeholder="+7 (___) ___-____"></div></div><button type="submit" class="subm btn btn-success">Подписаться</button></form>',"product-notify-dialog",null,!1,!0),a=o.find("[name=phone]"),r=o.find("[name=email]"),s=!1;if(i||(i=e(".shop-product-price-block .action-callback").data("product")),!i)return void console.log("product slug not found on page");NXUTILS.openModal(o),a.inputmask("mask",{mask:"+7 (999) 999-9999"}),o.submit(function(t){if(t.preventDefault(),s)NXUTILS.closeModal(o);else{var n=e.trim(a.val()).replace(/\D/g,""),l=e.trim(r.val());if(11!=n.length||"8"!=n.charAt(0)&&"7"!=n.charAt(0)||(n=n.substr(1)),n.length>0&&10!=n.length)return e.notifier.error("Укажите номер телефона, включая код города (10 цифр)"),void a.focus();var c={product_slug:i,phone:n,email:l,utrid:e.cookie("uTrID")};console.log("product notify request",c),e.ajax("/data/shop-product-notify-when-available",{data:JSON.stringify(c),contentType:"application/json",type:"POST"}).done(function(t){console.log("product notify result",t),t.ok?(o.find(".input-fields").html("Заявка принята.<br>Мы уведомим вас, когда данный товар появится в наличии."),o.find(".subm").text("Закрыть").removeClass("btn-success"),s=!0):t.error?e.notifier.error(t.error,!1,!0):e.notifier.error("Произошла ошибка",!1,!0)}).fail(function(){e.notifier.error("Сбой передачи данных",!1,!0)})}})}e(".action-product-notify-when-available").click(t)}function h(){e(".shop-category-list-nav [name=sort]").change(function(t){var n=e(this),i=n.val(),o=e.grep(NXUTILS.parseQueryStringArray(),function(e){return"sort"!=e.name}),a=window.location.pathname.replace(/\d+$/,"");i&&o.push({name:"sort",value:i}),o.length?window.location=a+"?"+e.param(o):window.location=a})}function m(){var t=e(".shop-product-filter-form");t.length&&("shopCategoryPdFltResults"in NXDATA&&e.notifier.info("Применен фильтр.<br>"+(NXDATA.shopCategoryPdFltResults?"Результат: "+NXUTILS.formatNumber(NXDATA.shopCategoryPdFltResults,"-"," товар"," товара"," товаров"):"Ничего не найдено")),t.on("click",".fieldset",function(t){t.stopPropagation();var n=e(this),i=e(t.target);!i.is(".clps")&&i.closest(".items").length||(n.hasClass("expanded")?n.removeClass("expanded").addClass("collapsed"):n.removeClass("collapsed").addClass("expanded"))}))}function v(){var t=e(".shop-product-filter-form-above"),n=t.find(".extra-filters"),i=t.find(".extra-filters-toggle");if(t.length){t.get(0).reset(),t.on("click",".fieldset .items > p",function(n){var i=e(this),o=e(n.target);console.log(n),o.is("span")&&(i.find("input").click(),setTimeout(function(){console.log("submit"),t.submit()},100))}),i.click(function(){n.slideToggle(function(){i.toggleClass("dropup")})});var o=location.pathname;o=o.substr(0,o.lastIndexOf("/")),e.getJSON("/data-c/product-filter"+o.substr(o.lastIndexOf("/"))+location.search,function(n){e.each(n,function(n,i){var o,a,r=n.split("~");if(o=1==r.length?t.find('input[name="'+r[0]+'"]'):t.find('input[name="'+r[0]+'"][value="'+r[1]+'"]'),a=o.closest("p"),!a.hasClass("selected")&&(a.find(".q").text(" ("+i+")"),!i)){a.addClass("hidden");var s=a.closest(".fieldset"),l=!1;s.find(".items > p").each(function(){e(this).is(".hidden")||(l=!0)}),l||s.hide()}})})}}function g(){e(document.body).on("click",".action-popup-page",function(t){t.preventDefault();var n=e(this).closest("[href]").attr("href"),i=n.lastIndexOf("/"),o="/popup"+n.substring(i);window.open(o,"popupPageWin","width=600,height=500,location=no,status=no,toolbar=no,menubar=no,scrollbars=1,resizable=1").focus()})}function b(){function t(){a.html('<img src="/captcha/'+r+"?r="+Math.round(1e7*Math.random())+'">'),o.val("")}var n=e("#find-my-order-form"),i=n.find('[name="orderId"]'),o=n.find('[name="ccode"]'),a=n.find(".captcha-image"),r=""+Math.round(1e7*Math.random());n.length&&(t(),n.submit(function(a){a.preventDefault();var s=e.trim(i.val()),l=e.trim(o.val());return s?l?(n.find(":input").prop("disabled",!0),e.notifier.wait("Отправка..."),void e.post("/data/find-my-order",{orderId:s,ckey:r,ccode:l}).done(function(a){n.find(":input").prop("disabled",!1),a.error?(e.notifier.error(a.error,!1,!0),t(),499==a.errorCode?o.focus():1==a.errorCode&&i.focus()):window.location=a.redirect}).fail(function(i){n.find(":input").prop("disabled",!1),e.notifier.error("Сбой соединения",!1,!0),t()})):(e.notifier.error("Введите цифровой код с картинки",!1,!0),void o.focus()):(e.notifier.error("Введите номер заказа",!1,!0),void i.focus())}))}function y(){e(".get-discount").click(function(t){t.preventDefault();var n=e(".shop-product-price-block .pp .p-before-disc"),i=e(".shop-product-price-block .pp .p-disc");n.addClass("p-before-disc-reduced"),setTimeout(function(){i.css("display","block")},250),e(".get-discount").hide(),e(".shop-product-price-block").data("discount-applied",!0)})}function k(){var t=NXUTILS.parseQueryString(),n=t.admitad_uid;n?e.cookie("admitad_uid",n,{path:"/",expires:90}):n=e.cookie("admitad_uid"),n&&e.ajax("/data/admitad",{data:JSON.stringify({admitad_uid:n,uid:e.cookie("uTrID"),url:location.pathname+location.search}),contentType:"application/json",type:"POST"})}function w(){function t(){var t=[],n=0;return e(".shop-cart-content-form .product-thumb").each(function(){var i=e(this).find('[name="qty"]');i.val()&&(n+=i.val()*i.data("unit-price"),t.push(""+e(this).data("upid")))}),{products:t,total:n}}function n(e,t,n){if(_tmr)try{var i={type:"itemView",list:"1",pagetype:e,productid:t||"",totalvalue:n?""+n:""};console.log("_tmr",i),_tmr.push(i)}catch(e){console.log("mail.ru remarketing error",e)}}if("/"==location.pathname)n("home");else if(NXDATA&&NXDATA.shopProductId)n("product",NXDATA.shopProductId,NXDATA.shopProductPrice);else if(NXDATA&&NXDATA.shopCategoryId)n("category");else if("/cart"==location.pathname){var i=t();n("cart",i.products,i.total),e(window).on("orderConfirmed.NXCMS",function(e,i){try{n("purchase",t().products,i.total)}catch(e){console.log("mailru remarketing error",e)}})}else n("other")}function T(){function t(){var t=[];return e(".shop-cart-content-form .product-thumb").each(function(){var n=e(this).find('[name="qty"]');n.val()&&t.push({id:""+e(this).data("upid"),price:parseFloat(n.data("unit-price")),quantity:parseInt(n.val(),10)})}),t}function n(e,t,n,i){if(dataLayer){var o={currencyCode:"RUB"},a={ecommerce:o};o[e]={products:t},n&&(o[e].actionField={id:n,revenue:i}),console.log("rambler dataLayer",a),dataLayer.push(a)}}NXDATA&&NXDATA.shopProductId?n("detail",function(){return[{id:NXDATA.shopProductId,price:NXDATA.shopProductPrice}]}()):"/cart"==location.pathname&&(n("add",t()),e(window).on("orderConfirmed.NXCMS",function(e,i){try{n("purchase",t(),i._id,i.total)}catch(e){console.log("rambler dataLayer error",e)}}))}("undefined"==typeof console||!1 in console)&&(window.console={log:function(){}}),window.NXDATA=window.NXDATA||{},window.NXDATA.adminLinks=[{link:"/shop_delivery_editor",role:"editor",label:"D",title:"Способы доставки"},{link:"/shop_orders_editor",role:"manager",label:"O",title:"Заказы"},{link:"#",role:"manager",label:"C",title:"Загрузка CSV",onclick:i},{link:"/shop_promo_editor",role:"editor",label:"P",title:"Промо-коды"},{link:"/product-list",role:"contributor",label:"L",title:"Список товаров"}],window.NXDATA.shopCookieDomain=".presidentwatches.ru";var C;e(function(){function i(){NXCMS.currentUserInRole("manager")&&(!NXDATA.shopCategory||"shopCategoryPdFlt"in NXDATA||e(".shop-csv").html('<a class="button secondary small radius btn btn-default" href="/data/shop-csv/'+NXDATA.shopCategory+'">Скачать CSV</a>'))}try{e(".pictures-block a.pic.zoom").swipebox({isTouch:!1}),e(".img-zoom").swipebox({isTouch:!1})}catch(e){console.log("swipebox error",e)}try{e(".magnify,[data-magnify-to]").magnify({maxProjectionHeight:400})}catch(e){console.log("magnify error",e)}var s=[],c=0,C=e(".pictures-block .zoom-select");C.each(function(){var t={href:e(this).attr("href"),title:e(this).attr("title"),img:new Image};t.img.src=t.href,s.push(t)}),C.click(function(t){t.preventDefault();var n=e(this),i=n.closest(".pictures-block").find(".main-pic .zoom-dynamic"),o=i.siblings(".video-pic-frame");if(n.is(".video-pic")){var a=n.data("video-pic-id"),r=n.data("video-pic-width"),s=n.data("video-pic-height"),l=i.height();o.height(l),i.hide(),o.show(),s>l&&(r=Math.round(r*l/s),s=l),o.html('<iframe width="'+r+'" height="'+s+'" src="https://www.youtube.com/embed/'+a+'?autohide=1&autoplay=1&loop=1&controls=0&modestbranding=1&rel=0&showinfo=0" frameborder="0" allowfullscreen></iframe>')}else o.hide(),o.empty(),i.show(),i.attr("href",n.attr("href")),i.attr("title",n.attr("title")),i.find("img").attr("src",n.data("main-pic-src"));c=n.index(),n.addClass("zoom-selected").siblings().removeClass("zoom-selected")}),e(".pictures-block a.pic.zoom-dynamic").click(function(t){t.preventDefault();try{e.swipebox(s,{startIdx:c,isTouch:!1})}catch(e){console.log("swipebox error",e)}}),a(),r(),function(){function t(){c.removeClass("open"),i.hide()}function n(){var t=e.trim(d.val());if(t!==a){if(a=t,r&&(clearTimeout(r),r=null),!t)return i.html('<li class="disabled"><a href="" class="no-click" tabindex="-1">Введите первые буквы/цифры</a></li>'),void(l=void 0);r=setTimeout(function(){ga("send","pageview","/site-search-dropdown?search="+encodeURIComponent(t)),e.getJSON("/data/shop-product-search",{q:t}).done(function(e){var t,n,o="";if(s=e.results&&e.results.length,l=void 0,s){for(t=0;t<s;t++)n=e.results[t],o+='<li><a href="'+n.link+'" tabindex="0">'+NXUTILS.escapeHTML(n.label)+"</a></li>";i.html(o)}else i.html('<li class="disabled"><a href="" class="no-click" tabindex="-1">Ничего не найдено</a></li>')})},300)}}var i,o,a,r,s,l,c=e("#nav-search-form"),d=c.find("[name=search]");c.submit(!1),d.focus(function(){o&&(clearTimeout(o),o=null),i?i.show():(i=e('<ul class="dropdown-menu pull-right nav-search-dropdown"><li class="disabled"><a href="" class="no-click" tabindex="-1">Введите первые буквы/цифры</a></li></ul>').appendTo(c),a=void 0,i.on("focus","a",function(e){o&&(clearTimeout(o),o=null)}),i.on("blur","a",function(e){o&&clearTimeout(o),o=setTimeout(t,100)})),c.addClass("open")}).blur(function(){o&&clearTimeout(o),o=setTimeout(t,100)}).keydown(function(e){27==e.keyCode?(e.preventDefault(),d.blur()):38==e.keyCode?(e.preventDefault(),s&&(l=l?l-1:s-1,i.find("li").eq(l).addClass("cur").siblings().removeClass("cur"))):40==e.keyCode?(e.preventDefault(),s&&(l=void 0===l?0:(l+1)%s,i.find("li").eq(l).addClass("cur").siblings().removeClass("cur"))):13==e.keyCode&&(e.preventDefault(),window.location=void 0!==l?i.find("a").eq(l).attr("href"):"/search"+(a?"?q="+encodeURIComponent(a):""))}).on("keyup",n).on("paste",function(e){setTimeout(n,10)})}(),e('[data-cat="'+NXDATA.shopCategory+'"]').addClass("current");var x=e(".category-tree");if(x.length){x.find("li:has(li)").each(function(){e(this).addClass("collapsed")});var S=x.find('[data-cat="'+NXDATA.shopCategory+'"]');S.length?(S.parents("li.collapsed").removeClass("collapsed").addClass("expanded"),S.hasClass("collapsed")&&S.removeClass("collapsed").addClass("expanded")):x.find(">ul>li").removeClass("collapsed").addClass("expanded"),x.on("click","li:has(li)",function(t){t.stopPropagation();var n=e(this);n.hasClass("expanded")?n.removeClass("expanded").addClass("collapsed"):n.removeClass("collapsed").addClass("expanded")}),x.show()}var N=e(".brands-panel .brands");if(N.length){var _=function(e,t){var n,i=N.width()+60,o=N.prop("scrollWidth"),a=N.scrollLeft();"l"==e?(n=o-i)>a&&N.animate({scrollLeft:n},1.5*(n-a)):"r"==e&&(n=0)<a&&N.animate({scrollLeft:n},1.5*(a-n))},A=function(){_("l")},I=function(){_("r")},D=function(){N.stop()};e(".brands-panel .rt").hover(A,D).mousedown(A).mouseup(D),e(".brands-panel .lt").hover(I,D).mousedown(I).mouseup(D)}e(window).on("userLoginStatusChanged.NXCMS",i),i(),h(),m(),v();var M=e(".pnavbar");if(M.length){var $=!1;e(document).one("touchstart",function(){$=!0,console.log("touch event detected")}),M.find(".ddwn > a").hover(function(){t(e(this))},n).click(function(n){$&&(n.preventDefault(),n.stopPropagation(),t(e(this)))}),M.find(".ddwn-menu").hover(function(){t(e(this))},n),e(document).click(n)}var P=e(".shop-category-list-nav .view-selector");if(P.length){var j=function(t,n){P.removeClass(n).addClass(t),e(".shop-category-list-holder").removeClass(n).addClass(t)};P.find("a").click(function(t){t.preventDefault(),P.hasClass("view-tiles")?(j("view-list","view-tiles"),e.cookie("shop-list-view","list",{path:"/"})):(j("view-tiles","view-list"),e.cookie("shop-list-view","tiles",{path:"/"}))});"list"==e.cookie("shop-list-view")&&j("view-list","view-tiles")}d();var X=e(".shop-category-top-pic");X.length&&e(window).on("shopDeliveryMethodsChanged.NXCMS",function(t){var n=e.grep(t.deliveryMethods,function(e){return e.outlets&&e.outlets.length});console.log("shop region",t.shopRegion,"delivery with outlets",n);var i;i="77000000000"==t.shopRegion[0]?'<p style="padding-top:5px;">Бесплатная доставка по Москве <small>при покупке от 2000 руб.</small></p><p>Широкая сеть <small>пунктов выдачи заказов</small></p><p>Гарантия <small>только от производителей</small></p><p>Возможность вернуть покупку <small>в течение 30 дней</small></p>':n.length?"<p>Курьерская доставка в Вашем городе</p><p>Сеть пунктов выдачи заказов <small>по всей России</small></p><p>Доставка Почтой России <small>наложенным платежом</small></p><p>Гарантия только от производителей</p><p>Возможность вернуть покупку <small>в течение 30 дней с момента получения</small></p>":'<p style="padding-top:20px;">Курьерская доставка в Вашем городе</p><p>Доставка Почтой России <small>наложенным платежом</small></p><p>Гарантия только от производителей</p><p>Возможность вернуть покупку <small>в течение 30 дней с момента получения</small></p>',X.find(".txt").remove(),e('<div class="txt">'+i+"</div>").appendTo(X)}),e(".action-characteristics-error-notify").click(o),e(".hl-active a").each(function(){var t=e(this);t.attr("href")==location.pathname&&t.addClass("active").closest("li").addClass("active")}),l(),u(),p(),f(),g(),b(),y(),k(),w(),T()})}(jQuery),function(){function e(e){n[o].classList.remove("current"),c[o].className="",o=(e+i)%i,n[o].classList.add("current"),c[o].className="current"}var t=document.querySelector(".custom-slider");if(null!=t){var n=t.querySelectorAll(".slider_item"),i=n.length,o=0;n[o].classList.add("current");for(var a=setInterval(function(){e(o+1)},2e3),r=t.querySelector(".dots"),s="",l=0;l<i;l++)s+="<b></b>";r.innerHTML=s;var c=r.querySelectorAll("b");c[o].className="current";for(var l=0;l<c.length;l++)c[l].onclick=function(t){return function(){e(t)}}(l);t.onmouseover=function(){clearInterval(a)},t.onmouseout=function(){a=setInterval(function(){e(o+1)},2e3)};var d=t.querySelector(".next"),u=t.querySelector(".prev");d.onclick=function(){e(o+1)},u.onclick=function(){e(o-1)}}}(),function(e){function t(t){t.preventDefault();var i=R.find("[name=fio]"),o=R.find("[name=phone]"),a=R.find("[name=email]"),s=R.find("[name=address]"),l=R.find("[name=notes]"),c=e.trim(i.val()),d=e.trim(o.val()).replace(/\D/g,""),u=e.trim(a.val()),p=e.trim(s.val()),f=e.trim(l.val()),h=e(".shop-delivery-method-selector"),m=e(".shop-payment-method-selector"),v=h.find("[name=dm]:checked").data("delivery-method"),g=h.find(".sel [data-outlet-idx]").data("outlet-idx"),b=m.find("[name=pm]:checked").val(),y=e.trim(O.find("[name=promo]").val());if(c.length<2)return e.notifier.error("Укажите ваше имя"),void i.focus();if(11!=d.length||"8"!=d.charAt(0)&&"7"!=d.charAt(0)||(d=d.substr(1)),10!=d.length)return e.notifier.error("Укажите номер телефона, включая код города (10 цифр)"),void o.focus();if(v&&v.need_email&&u.length<2)return e.notifier.error("Укажите ваш email"),void a.focus();var k={cart:T(),fio:c,phone:d,email:u,address:p,notes:f,region:z[0],dm:v&&v._id,dm_outlet:v&&v.outlets&&v.outlets.length>0&&null!==g&&v.outlets[g]?v.outlets[g].address:null,pm:b,promo_code:y,utrid:e.cookie("uTrID"),admitad_uid:e.cookie("admitad_uid")};console.log("order",k),R.find(":input").prop("disabled",!0),e.ajax("/data/shop-orders/",{data:JSON.stringify(k),contentType:"application/json",type:"POST"}).done(function(t){console.log("order result",t),n(t),R.find(":input").prop("disabled",!1),t._id?(e(window).trigger("orderConfirmed.NXCMS",[t]),r(),e(".shop-order-details").hide(),setTimeout(function(){window.location="/page/cart-success"},250)):e.notifier.error("Произошла ошибка",!1,!0)}).fail(function(){R.find(":input").prop("disabled",!1),e.notifier.error("Сбой передачи данных",!1,!0)})}function n(t){try{var n={order_id:t._id,order_price:t.total,currency:"RUR",exchange_rate:1,goods:[]};e.each(t.cart,function(e,t){n.goods.push({name:t.item,price:t.unit_price,quantity:t.quantity})}),console.log("reachGoal orderConfirmed",n),yaCounter14657887.reachGoal("orderConfirmed",n),ga("ecommerce:addTransaction",{id:t._id,revenue:t.total}),e.each(t.cart,function(e,n){ga("ecommerce:addItem",{id:t._id,name:n.item,price:n.unit_price,quantity:n.quantity})}),ga("ecommerce:send")}catch(e){console.log("metrika track error",e)}}function i(t){t.preventDefault(),e(this).closest(".product-thumb").remove(),O.find(".product-thumb").length?o():r(!0)}function o(t){var n=0,i=0,a={},r=!1,s="<h5>Ваш заказ</h5><ol>",l=NXUTILS.escapeHTML;B=!1,O.find("[name=qty]").each(function(){var t=e(this),o=t.closest(".product-thumb"),c=Math.max(parseInt(e.trim(t.val()),10)||0,0),d=t.data("product"),u=parseFloat(t.data("unit-price")),p=!!t.data("apply-discount"),f=!!t.data("delivery-price-approx"),h=!!t.data("free-delivery"),m=NXUTILS.formatMoney(c*u,0,String.fromCharCode(160));t.val(c),i+=c,n+=c*u,c?(a[d]={quantity:c},p&&(a[d].discount="Y")):delete a[d],o.find(".sum").text(m),s+='<li><span class="t">'+l(o.find("a.t").text())+'</span><span class="q">Кол-во: '+c+' шт.</span><span class="p">Цена: '+m+" руб.</span></li>",f&&(r=!0),h&&(B=!0)}),B&&(r=!1),S(a),y(i,n);var c=e.trim(O.find("[name=promo]").val());if(c){if(!V||c!=V.code||!C(T(),V.cart))return V={code:c,cart:T()},void e.ajax("/data/shop-promo-apply",{data:JSON.stringify(V),contentType:"application/json",type:"POST"}).done(function(e){V=e,V.calculated=!0,o()}).fail(function(){e.notifier.error("Сбой соединения")});if(!V.calculated)return;V.discount?(O.find(".promo .m").html('Скидка по промо-коду: <span class="p">'+NXUTILS.formatMoney(V.discount,0,String.fromCharCode(160))+" руб.</span>"),n-=V.discount):O.find(".promo .m").html("Скидка по данному коду для выбранных товаров не предоставляется")}else O.find(".promo .m").text("Промо-код не введен");var d=NXUTILS.formatMoney(n,0,String.fromCharCode(160));O.find(".total").text(d),s+="</ol><p>Итого: "+d+" руб. <i>(без учета доставки)</i></p>",s+='<div><button class="btn btn-xs action-cart-step1">Изменить</button></div>';var u,p=e(".shop-delivery-method-selector"),f=p.find("[name=dm]:checked").data("delivery-method"),h=p.find(".sel [data-outlet-idx]").data("outlet-idx"),m=f&&f.outlets&&f.outlets.length>0&&null!==h&&f.outlets[h]?f.outlets[h]:null;f&&(console.log("recalcCart dm:",f,m,"freeDelivery:",B,"deliveryPriceApprox:",r),B&&"pickpoint"!=f.source_id&&"spsr"!=f.source_id?u=0:m&&m.price?u=m.price:(u=f.price,r=r||f.price_approx),f.price_threshold&&n>=f.price_threshold&&(u=0),r?(s+="<p>Доставка: от "+NXUTILS.formatMoney(u,0,String.fromCharCode(160))+" руб.",f.outlets&&f.outlets.length>1&&!m?s+=" <i>(для уточнения стоимости выберите пункт выдачи)</i></p>":s+=" <i>(окончательную стоимость доставки Вам сообщит менеджер при подтверждении заказа)</i></p>"):(s+="<p>Доставка: "+NXUTILS.formatMoney(u,0,String.fromCharCode(160))+" руб.</p>",s+="<p>К оплате: "+NXUTILS.formatMoney(n+u,0,String.fromCharCode(160))+" руб.</p>")),e(".shop-order-details .shop-cart-content-brief").html(s),i?e(".action-cart-step2").prop("disabled",!1):e(".action-cart-step2").prop("disabled",!0)}function a(e){e.preventDefault(),r(!0)}function r(t){S({}),y(0,0),e(".shop-order-details").hide(),t&&e(".shop-cart-content").html("<p>Корзина пустая.</p>")}function s(t){t.preventDefault();var n=e(this),i=NXUTILS.constructModal("Обратный звонок",'<form><div class="form-group"><label for="inputPhoneCallback">Введите ваш номер телефона</label><input type="tel" name="phone" class="form-control" id="inputPhoneCallback" placeholder="+7 (___) ___-____"></div><button type="submit" class="subm btn btn-success">Жду звонка!</button></form>',"shop-callback-dialog",null,!1,!0),o=i.find("[name=phone]"),a=!1;NXUTILS.openModal(i),o.inputmask("mask",{mask:"+7 (999) 999-9999"}),i.submit(function(t){if(t.preventDefault(),a)NXUTILS.closeModal(i);else{var r=n.data("product"),s=e(".shop-product-price-block").data("discount-applied"),l=x(),c=e.trim(o.val()).replace(/\D/g,"");if(11!=c.length||"8"!=c.charAt(0)&&"7"!=c.charAt(0)||(c=c.substr(1)),10!=c.length)return e.notifier.error("Укажите номер телефона, включая код города (10 цифр)"),void o.focus();r||(r=e(".shop-product-price-block .action-callback").data("product")),!r||r in l||(l[r]={quantity:1},s&&(l[r].discount="Y"));var d={cart:T(l),fio:"Обратный звонок",phone:c,notes:"Обратный звонок",region:z[0],callback_order:!0,utrid:e.cookie("uTrID"),admitad_uid:e.cookie("admitad_uid")};console.log("callback order",d),e.ajax("/data/shop-orders/",{data:JSON.stringify(d),contentType:"application/json",type:"POST"}).done(function(t){console.log("order result",t),t._id?(i.find(".form-group").html("Заявка на обратный звонок принята.<br>В ближайшее время мы свяжемся с вами."),i.find(".subm").text("Закрыть").removeClass("btn-success"),a=!0):e.notifier.error("Произошла ошибка",!1,!0)}).fail(function(){e.notifier.error("Сбой передачи данных",!1,!0)})}})}function l(t){t&&t.preventDefault(),e.getJSON("/data/shop-delivery/$regions").done(function(t){function n(){m.hide()}function i(){if(void 0!==p){var e=m.find("li").eq(p),t=m.scrollTop(),n=t+m.innerHeight(),i=t+e.position().top,o=i+e.height();e.addClass("cur").siblings().removeClass("cur"),i<t&&m.scrollTop(i),o>n&&m.scrollTop(t+(o-n))}}function o(){var t=e.trim(h.val());if(t!==f){if(f=t,d&&(clearTimeout(d),d=null),!t||t.length<2)return m.hide().empty(),u=0,void(p=void 0);d=setTimeout(function(){e.getJSON("/data/address-search",{q:t}).done(function(e){var t,n,o="";if(u=e.results&&e.results.length||0){for(p=0,t=0;t<u;t++)n=e.results[t],o+='<li><a tabindex="0" href="#" data-shop-region="'+n._id+'" data-shop-region-name="'+NXUTILS.escapeHTML(n.name)+'">'+NXUTILS.escapeHTML(n.full_address.join(" - "))+"</a></li>";m.html(o)}else p=void 0,m.html('<li class="disabled"><a href="" class="no-click" tabindex="-1">Ничего не найдено</a></li>');i(),h.is(":focus")&&m.show()})},300)}}var a=t.regions,r=NXUTILS.escapeHTML,s='<div class="w"><input type="text" class="region-search" placeholder="Введите название своего города / населенного пункта"><ul class="dd"></ul><table class="regions-table"><tr><td><ul class="region-list">';e.each(a,function(e,t){var n="77000000000"==t._id||"78000000000"==t._id?' class="bold"':"";e&&e%15==0&&(s+='</ul></td><td><ul class="region-list">'),s+="<li"+n+'><a href="#" data-shop-region="'+t._id+'" data-shop-region-name="'+r(t.name)+'" title="'+r(t.full_address.join(" - "))+'">'+r(t.name)+"</a></li>"}),s+="</ul></td></tr></table></div>";var l=NXUTILS.constructModal("Доставляем по всей России",s,"shop-region-selector-dialog",null,!1,!0);l.on("click","a",function(t){t.preventDefault();var n=e(this),i=[""+n.data("shop-region"),n.data("shop-region-name")];NXUTILS.closeModal(l),M(i)});var c,d,u,p,f,h=l.find(".region-search"),m=l.find(".dd");h.focus(function(){c&&(clearTimeout(c),c=null),u&&m.show()}).blur(function(){c&&clearTimeout(c),c=setTimeout(n,100)}).keydown(function(e){27==e.keyCode?(e.preventDefault(),h.blur()):38==e.keyCode?(e.preventDefault(),u&&(p=p?p-1:u-1,i())):40==e.keyCode?(e.preventDefault(),u&&(p=void 0===p?0:(p+1)%u,i())):13==e.keyCode&&(e.preventDefault(),void 0!==p&&m.find("a").eq(p).click())}).on("keyup",o).on("paste",function(e){setTimeout(o,10)}),m.on("focus","a",function(e){c&&(clearTimeout(c),c=null)}).on("blur","a",function(e){c&&clearTimeout(c),c=setTimeout(n,100)}),NXUTILS.openModal(l)}).fail(function(){e.notifier.error("Сбой соединения")})}function c(t){console.log("new shopRegion",z),e(".shop-region-select").text(z[z.length-1]),d(z,t.newRegionSelected)}function d(t,n){e.ajax("/data/shop-delivery/$delivery",{data:JSON.stringify({rgn:t[0]}),contentType:"application/json",type:"POST"}).done(function(t){var i=t.delivery,o=t.primary,a=NXUTILS.escapeHTML;H=i,u(i);var r=e("#shop-product-benefits");o&&(o.contacts&&(e("#ya-phone").html()||e(".shop-primary-contacts").html('<a href="tel:'+o.contacts.replace(/[^\+0-9]/g,"")+'" class="phone">'+a(o.contacts)+'</a><span class="hours">'+a(o.working_hours)+"</span>")),o.content&&r.find(">div").html(o.content)),r.show(),p();var s=jQuery.Event("shopDeliveryMethodsChanged.NXCMS");s.deliveryMethods=H,s.primaryMethod=o,s.shopRegion=z,s.newRegionSelected=n,e(window).trigger(s),R.trigger("shopDeliveryMethodSelected.NXCMS")}).fail(function(e,t,n){console.log("delivery methods request failed",e,t,n)})}function u(t){var n,i=!1,o="",a='<form class="shop-delivery-method-selector">',r=NXUTILS.escapeHTML;e.each(t,function(t,s){var l,c=s.pricing||"";B&&"pickpoint"!=s.source_id&&"spsr"!=s.source_id?(c="бесплатно",i=!0):c||(0===s.price?(c="бесплатно",i=!0):((!n||s.price<n)&&(n=s.price),s.price_approx&&(c="от "),c+=s.price+" руб.",s.price_threshold&&(l=e(".shop-cart-content-form").length?k()[1]:parseInt(e(".shop-product-price-block").data("product-price"),10),l>=s.price_threshold?(c="бесплатно",i=!0):c+=", бесплатно от "+s.price_threshold+" руб."))),a+='<label><input type="radio" name="dm" value="'+s._id+'"> <span class="t">'+r(s.title)+'</span> <span class="det"><span class="pl">Стоимость: <span class="p">'+r(c)+'</span></span> <span class="sl">Примерный срок: <span class="s">'+r(s.terms)+"</span></span></span>",t<2&&(o+='<div><span class="t">'+r(s.title)+'</span>: <span class="p">'+r(c)+"</span></div>"),s.outlets&&s.outlets.length&&(1==s.outlets.length?a+=' <span class="addr">Адрес: <a href="#" class="action-show-on-map address" title="Показать на карте" data-outlet-idx="0" data-tip="Пункт выдачи" data-coords="'+s.outlets[0].location.lat+","+s.outlets[0].location.lng+'">'+r(s.outlets[0].address)+"</a></span>":a+=' <span class="addr">Адрес: <a href="#" class="action-select-outlet address not-selected">не выбран</a> <button class="action-select-outlet btn btn-sm">выбрать адрес</button></span>'),s.description&&(a+=' <span class="desc">'+s.description+"</span>"),a+="</label>"}),a+="</form>",i?e(".shop-product-price-block .dl a").text("Бесплатная доставка"):n&&e(".shop-product-price-block .dl a").text("Доставка от "+n+" руб."),e(".shop-product-delivery .dlvr").html(o).show(),e(a).appendTo(e(".shop-delivery").empty()).on("click","label",function(n){n.preventDefault(),n.stopPropagation();var i,o=e(this),a=o.find("[name=dm]"),r=e(n.target),s=a.val();setTimeout(function(){a.prop("checked",!0)},10),o.addClass("sel").siblings().removeClass("sel"),e.each(t,function(e,t){t._id==s&&(a.data("delivery-method",t),i=t)}),console.log("dm selected",i),p(i),i.need_address?R.find(".client-address").show():R.find(".client-address").hide(),r.hasClass("action-show-on-map")?m(i,r.data("outlet-idx")):r.hasClass("action-select-outlet")&&f(i,o.find(".address")),setTimeout(function(){R.trigger("shopDeliveryMethodSelected.NXCMS")},10)})}function p(t){var n,i,o,a,r="",s=NXUTILS.escapeHTML;for(r+='<form class="shop-payment-method-selector">',n=0;n<F.length;n++)i=F[n],a=!t,a||"payment_cash"!==i.id||t.payment_cash||(a=!0),a||"payment_cards"!==i.id||t.payment_cards||(a=!0),r+="<label"+(a?' class="disabled"':"")+'><input type="radio" name="pm" value="'+i.id+'" '+(a?" disabled":"")+'> <span class="t">'+s(i.title)+"</span>",r+="</label>";r+="</form>",o=e(r).appendTo(e(".shop-payment").empty()),e(".shop-payment-description").empty(),o.on("click","[name=pm]",function(t){var n=e(this),i=n.val(),o=e.grep(F,function(e){return e.id==i});n.closest("label").addClass("sel").siblings().removeClass("sel"),e(".shop-payment-description").html(o[0].description)}),o.on("click",".disabled",function(n){e.notifier.error(t?"При выбранном способе доставки данный способ оплаты недоступен":"Сначала выберите способ доставки")})}function f(t,n){var i,o,a,r,s="",l=NXUTILS.escapeHTML;for(s+='<ul class="nav nav-tabs"><li class="active"><a href="#" class="by-list">Списком</a></li><li><a href="#" class="by-map">На карте</a></li></ul>',s+='<div class="outlets-by-list">',s+="<ul>",i=0;i<t.outlets.length;i++)o=t.outlets[i],s+="<li>",s+='<span class="a"><i class="glyphicon glyphicon-map-marker"></i> '+l(o.address)+"</span>",o.description&&(s+=' <span class="d">'+l(o.description)+"</span>"),(o.contacts||t.contacts)&&(s+=' <span class="p"><i class="glyphicon glyphicon-phone-alt"></i> '+l(o.contacts||t.contacts)+"</span>"),(o.working_hours||t.working_hours)&&(s+=' <span class="w"><i class="glyphicon glyphicon-time"></i> '+l(o.working_hours||t.working_hours)+"</span>"),(o.price||t.price||o.terms||t.terms)&&(s+=' <span class="w"><i class="glyphicon glyphicon-shopping-cart"></i> ',(o.price||t.price)&&(s+=(o.price||t.price)+" руб. "),(o.terms||t.terms)&&(s+=o.terms||t.terms),s+="</span>"),s+="</li>";s+="</ul>",s+="</div>",s+='<div class="outlets-by-map" style="display:none;"><div class="map"></div></div>',r=NXUTILS.constructModal("Выберите пункт выдачи",s,"shop-outlet-selector-dialog");var c=function(){a=new ymaps.Map(r.find(".map").get(0),{center:[55.755768,37.617671],zoom:16,
behaviors:["default","scrollZoom"],controls:["zoomControl","typeSelector","rulerControl"]});var e,n,i,o,s=new ymaps.GeoObjectCollection;for(n=0;n<t.outlets.length;n++)i=t.outlets[n],o='<div class="bcont">',i.description&&(o+='<span class="d">'+l(i.description)+"</span>"),(i.contacts||t.contacts)&&(o+=' <span class="p"><i class="glyphicon glyphicon-phone-alt"></i> '+l(i.contacts||t.contacts)+"</span>"),(i.working_hours||t.working_hours)&&(o+=' <span class="w"><i class="glyphicon glyphicon-time"></i> '+l(i.working_hours||t.working_hours)+"</span>"),(i.price||t.price||i.terms||t.terms)&&(o+=' <span class="w"><i class="glyphicon glyphicon-shopping-cart"></i> ',(i.price||t.price)&&(o+=(i.price||t.price)+" руб. "),(i.terms||t.terms)&&(o+=i.terms||t.terms),o+="</span>"),o+='<button class="btn btn-success o-select" data-idx="'+n+'">Выбрать</button>',o+="</div>",e=new ymaps.Placemark([i.location.lat,i.location.lng],{hintContent:i.address,balloonContentHeader:i.address,balloonContentBody:o}),s.add(e);a.geoObjects.add(s),a.setBounds(s.getBounds(),{zoomMargin:20})},d=function(e){console.log("outlet selected",e),n.next("button").text("выбрать другой адрес"),n.replaceWith('<a href="#" class="action-show-on-map address" title="Показать на карте" data-tip="Пункт выдачи" data-outlet-idx="'+e+'" data-coords="'+t.outlets[e].location.lat+","+t.outlets[e].location.lng+'">'+l(t.outlets[e].address)+"</a>"),R.trigger("shopDeliveryMethodSelected.NXCMS")};r.on("click",".nav-tabs a",function(t){t.preventDefault(),t.stopPropagation();var n=e(this);n.hasClass("by-map")?(r.find(".outlets-by-list").hide(),r.find(".outlets-by-map").show(),a||(window.ymaps?c():e.getScript("https://api-maps.yandex.ru/2.1/?lang=ru-RU",function(){ymaps.ready(c)}))):(r.find(".outlets-by-list").show(),r.find(".outlets-by-map").hide()),n.closest("li").addClass("active").siblings().removeClass("active")}),r.on("click",".outlets-by-list li",function(t){t.preventDefault();var n=e(this);d(n.index()),NXUTILS.closeModal(r)}),r.on("click",".outlets-by-map .o-select",function(t){t.preventDefault(),t.stopPropagation();var n=e(this);d(n.data("idx")),NXUTILS.closeModal(r)}),NXUTILS.openModal(r),r.on("closed hidden.bs.modal",function(){console.log("modal closed"),r.remove()})}function h(t){t.preventDefault();var n=e(this).data("dm-id"),i=e(this).data("outlet-idx"),o=e.grep(H,function(e){return e._id==n})[0];console.log("dm clicked",o,i),m(o,i)}function m(t,n){var i,o=t.outlets[n],a=NXUTILS.escapeHTML,r="";r+='<div class="map"></div>',i=NXUTILS.constructModal(o.address,r,"shop-outlet-map-dialog"),NXUTILS.openModal(i),i.on("closed hidden.bs.modal",function(){console.log("modal closed"),i.remove()});var s=function(){var e,n,r;e=new ymaps.Map(i.find(".map").get(0),{center:[o.location.lat,o.location.lng],zoom:16,behaviors:["default","scrollZoom"],controls:["zoomControl","typeSelector","rulerControl"]}),r='<div class="bcont">',o.description&&(r+='<span class="d">'+a(o.description)+"</span>"),(o.contacts||t.contacts)&&(r+=' <span class="p"><i class="glyphicon glyphicon-phone-alt"></i> '+a(o.contacts||t.contacts)+"</span>"),(o.working_hours||t.working_hours)&&(r+=' <span class="w"><i class="glyphicon glyphicon-time"></i> '+a(o.working_hours||t.working_hours)+"</span>"),(o.price||t.price||o.terms||t.terms)&&(r+=' <span class="w"><i class="glyphicon glyphicon-shopping-cart"></i> ',(o.price||t.price)&&(r+=(o.price||t.price)+" руб. "),(o.terms||t.terms)&&(r+=o.terms||t.terms),r+="</span>"),r+="</div>",n=new ymaps.Placemark([o.location.lat,o.location.lng],{hintContent:o.address,balloonContentHeader:o.address,balloonContentBody:r}),e.geoObjects.add(n)};window.ymaps?s():e.getScript("https://api-maps.yandex.ru/2.1/?lang=ru-RU",function(){ymaps.ready(s)})}function v(t){t.preventDefault();var n=e(this);if(n.hasClass("btn-warning"))return void(location="/cart");var i=n.data("product"),o=e(".shop-product-price-block").data("discount-applied");i&&g(i,o)}function g(e,t){var n=x();e in n?n[e].quantity++:n[e]={quantity:1},t&&(n[e].discount="Y"),S(n),L("cartInfo"),b(n,!1,!0)}function b(t,n,i){console.log("cart",t),n&&e.notifier.wait("Подождите..."),e.ajax("/data/cart/details",{data:JSON.stringify(T(t)),contentType:"application/json",type:"POST"}).done(function(t){if(t.error)return void e.notifier.error(t.error,!1,!0);n&&e.notifier.success('Товар добавлен в корзину. <a href="/cart" class="alert-link">Оформить заказ »</a>',!1,!0),y(t.numItems,t.total),i&&(window.location="/cart")}).fail(function(){e.notifier.error("Сбой передачи данных",!1,!0)})}function y(e,t){e?X("cartInfo",e+":"+t):(L("cartInfo"),L("cart")),w()}function k(){var e=j("cartInfo"),t=e?e.split(":"):null;return[t?parseInt(t[0],10):0,t?parseFloat(t[1]):0]}function w(){var t,n=j("cart"),i=j("cartInfo"),o=i?i.split(":"):null,a=o?parseInt(o[0],10):0,r=o?parseFloat(o[1]):0;if(n&&!i)return void b(x());!n&&i&&(L("cartInfo"),i=void 0,a=0,r=0),i!==q&&(q=i,a&&r?(t=NXUTILS.formatNumber(a,"-"," товар"," товара"," товаров"),E.addClass("non-empty")):(t="Корзина",E.removeClass("non-empty")),e(".cart-info").html(t))}function T(t){var n=[];return e.each(t||x(),function(t,i){i&&i.quantity&&n.push(e.extend({item:t},i))}),n}function C(e,t){if(!e||!t)return!1;if(e.length!=t.length)return!1;var n=function(e,t){return e.item>t.item?1:t.item>e.item?-1:0};e.sort(n),t.sort(n);var i;for(i=0;i<e.length;i++)if(e[i].item!==t[i].item||e[i].quantity!==t[i].quantity)return!1;return!0}function x(){var t=j("cart"),n=t?t.split(";"):null,i={};try{n&&e.each(n,function(e,t){var n=t.split(":"),o=n[0];if(i[o]={quantity:parseInt(n[1])},n.length>2)for(var a=2;a+1<n.length;a+=2)i[o][n[a]]=n[a+1]})}catch(e){console.log("invalid cart cookie",t)}return i}function S(t){var n=[];e.each(t,function(t,i){var o=t+":"+i.quantity;e.each(i,function(e,t){"quantity"!=e&&(o+=":"+e+":"+t)}),n.push(o)}),n.length?X("cart",n.join(";"),{expires:30}):L("cart")}function N(){j("regionAsked")&&"/cart"!=location.pathname&&"/info/delivery"!=location.pathname||setTimeout(function(){var t=e(".region-confirm");if(t.length){var n=e('<div class="pup"><p>Ваш регион: <span>'+NXUTILS.escapeHTML(z[1])+'?</span><button class="yes">— Да, всё верно</button><button class="no">— Нет, сменить регион</button></p></div>').appendTo(t).height(100);n.on("click","button.yes",function(e){e.preventDefault(),M(z)}),n.on("click","button.no",function(e){e.preventDefault(),l()}),X("regionAsked","Y")}},1500)}function _(){e(".region-confirm").empty()}function A(){setTimeout(A,1e3);var t=j("shopRgn2"),n=!!t;if(t!==G){G=t;var i=NXUTILS.parseQueryString(),o=i.region;n?D(t.split("|")):/^\d{11}$/.test(o)?(z=[o,"Ваш город"],e.getJSON("/data/address-search",{ids:o}).done(function(e){e.length?(console.log("force region",e[0]),M([e[0]._id,e[0].name])):D()})):e.ajax({url:"http://api-maps.yandex.ru/1.1/?lang=ru_Ru",dataType:"script",timeout:1e3,success:function(e,t,n){try{I(YMaps.location.latitude,YMaps.location.longitude,"")}catch(e){I("","",""+e)}},error:function(e,t,n){I("","",t)}})}}function I(t,n,i){console.log("geoip latitude:",t,"longitude:",n,"error:",i),e.getJSON("/data/yandex_geoip",data={latitude:t,longitude:n,error:i}).done(function(e){e.length?(console.log("geoip region:",e[0]),M(e)):D()}).fail(function(e,t,n){console.log("geoip request failed",e,t,n)})}function D(t){t?(z=t,_()):N();var n=jQuery.Event("shopRegionChanged.NXCMS");n.region=z,n.newRegionSelected=!1,e(window).trigger(n,z)}function M(t){var n=t.join("|");X("shopRgn2",n,{expires:3650}),G=n,z=t,_();var i=jQuery.Event("shopRegionChanged.NXCMS");i.region=t,i.newRegionSelected=!0,e(window).trigger(i,t)}function $(){var t=e(this).data("order-id"),n=e(this).data("order-sig"),i=e(this).data("order-email");e(this).prop("disabled",!0),e.ajax("/data/shop-orders/invoice/"+t,{data:JSON.stringify({sig:n}),contentType:"application/json",type:"POST"}).done(function(t){if(t.error||!t.invoice)return e(this).prop("disabled",!1),void e.notifier.error(t.error||"Сбой передачи данных");P(t.invoice.id,t.invoice.amount,i,t.invoice.items)}).fail(function(){e.notifier.error("Сбой передачи данных"),e(this).prop("disabled",!1)})}function P(t,n,i,o){var a='<form style="display:none" action="https://payments248.paysecure.ru/pay/order.cfm" method="post" target="_top">';e.each({Merchant_ID:"877250",OrderComment:"Оплата заказа #"+t,OrderAmount:n,ChequeItems:JSON.stringify({items:o}),OrderNumber:t,Language:"RU",Email:i,URL_RETURN:location.href},function(e,t){a+='<input type="hidden" name="'+e+'" value="'+NXUTILS.escapeHTML(t)+'" />'}),a+="</form>",console.log(a),e(a).appendTo(document.body).get(0).submit()}function j(t){return e.cookie(t)}function X(t,n,i){console.log("setShopCookie",t,n,e.extend({},W,i)),L(t,i),e.cookie(t,n,e.extend({},W,i))}function L(t,n){e.removeCookie(t),e.removeCookie(t,n),e.removeCookie(t,e.extend({path:"/"},n)),e.removeCookie(t,e.extend({},W,n))}function U(){var t=e("#delivery-banner-wrapper");t.length&&"/cart"!=location.pathname&&"/info/delivery"!=location.pathname&&(e(window).on("shopDeliveryMethodsChanged.NXCMS",function(n){if(!n.newRegionSelected)return void t.empty();var i,o,a,r="",s="",l=0,c=!1,d=!1,u={};e.each(n.deliveryMethods,function(e,t){/^(sdek|spsr|courier_msk)$/.test(t.source_id)?(void 0===i||t.price&&t.price<i)&&(i=t.price_threshold?0:t.price,r=t.terms):"office_msk"==t.source_id?(c=!0,o=0,s="сегодня/ завтра"):"shop_msk"==t.source_id?(d=!0,o=0,s="сегодня/ завтра"):t.outlets&&t.outlets.length&&(u[t.source_id]||(u[t.source_id]=!0,l+=t.outlets.length,a=t.outlets[0],(void 0===o||t.price&&t.price<o)&&(o=t.price_threshold?0:t.price,s=t.terms),console.log("dm",t.source_id,t.outlets.length)))}),console.log("new shop region selected",n.shopRegion,"courier:",i,r,"outlets:",l,"msk:",c,d);var p,f="",h="",m=NXUTILS.escapeHTML;void 0!==i&&(f="<h2>Доставим курьером</h2><ul><li>От "+i+" руб. "+m(r)+"</li><li>Проверь до оплаты</li><li>Оплати при получении</li></ul>"),l&&(h=1==l?"<h2>Забери сам из пункта выдачи</h2><ul><li>От "+o+" руб. "+m(s)+"</li><li>В пункте выдачи по адресу: "+m(a.address)+"</li>":"<h2>Забери сам из пунктов выдачи</h2><ul><li>От "+o+" руб. "+m(s)+"</li><li>В одном из "+NXUTILS.formatNumber(l,""," пункта"," пунктов"," пунктов")+" выдачи</li>",c&&(h+="<li>В офисе на Нагатинской</li>"),d&&(h+="<li>В магазине на Тульской</li>"),h+="<li>Оплати при получении</li></ul>"),p="<h2>Доставим Почтой России</h2><ul><li>300 рублей, 5-7 дней</li><li>Отправим 1-классом</li><li>Оплати при получении</li></ul>",e('<div class="delivery-banner"><div class="head">Регион: <b>'+n.shopRegion[1]+'</b> <a href="/info/delivery">Подробнее о доставке</a> <a href="#" class="chg-rgn">Сменить регион</a><span class="close"></span></div><div class="courier">'+f+'</div><div class="outlets">'+h+'</div><div class="rupost">'+p+"</div></div>").appendTo(t.empty()).height(180)}),t.on("click",".chg-rgn,.head b",function(e){e.preventDefault(),l()}),t.on("click",".close",function(e){e.preventDefault(),t.empty()}))}("undefined"==typeof console||!1 in console)&&(window.console={log:function(){}});var E,O,R,V,B,F=[{id:"payment_cash",title:"Наличными при получении",description:"Оплата наличными курьеру либо в пункте выдачи/самовывоза."},{id:"payment_cards",title:"Банковской картой при получении",description:"Оплата банковской картой курьеру либо в пункте выдачи/самовывоза."},{id:"payment_assist",title:"Qiwi-кошелек",description:"Предоплата через терминалы Qiwi, либо через Qiwi-кошелек. Укажите email-адрес для информирования о статусе заказа и оплаты."},{id:"payment_assist",title:"Банковской картой VISA, Maestro или MasterCard онлайн",description:"Предоплата через систему Assist. Укажите email-адрес для информирования о статусе заказа и оплаты."},{id:"payment_assist",title:"Яндекс.Деньги",description:"Предоплата через систему Assist. Укажите email-адрес для информирования о статусе заказа и оплаты."},{id:"payment_assist",title:"WebMoney",description:"Предоплата через систему Assist. Укажите email-адрес для информирования о статусе заказа и оплаты."},{id:"payment_bank",title:"Банковским переводом",description:"Предоплата путем перечисления денег по предоставленным реквизитам."}];e(function(){e(".shop-product-price-block").data("product-free-delivery")&&(B=!0),e(".action-add-to-cart").click(v),e(".action-callback").click(s),E=e(".cart"),E.length&&(w(),setInterval(w,1e3)),O=e(".shop-cart-content-form"),O.length&&(O.on("change","input[name=qty]",o),O.on("change","input[name=promo]",o),O.on("click",".remove",i),O.find(".action-recalc").click(!1),O.submit(!1),e(".action-clear-cart").click(a),e(".action-cart-step2").click(function(){e(".shop-cart-content").hide(),e(".shop-order-details").show()}),e(document).on("click",".action-cart-step1",function(){e(".shop-order-details").hide(),e(".shop-cart-content").show()}),o()),R=e("#shop-order-form"),R.length&&(R.submit(t),R.find("[name=phone]").inputmask("mask",{mask:"+7 (999) 999-9999"}),e(".ya-order-button a").click(function(t){var n;t.preventDefault(),window.yaQuickAddress=function(e){var t=function(e){return e||""};n.close(),console.log("yandex quick order",e),R.find("[name=fio]").val(t(e.lastname)+" "+t(e.firstname)+" "+t(e.fathersname)),R.find("[name=phone]").val(t(e.phone)),R.find("[name=email]").val(t(e.email));var i="",o=function(e,t){e&&(i+=", "+(t||"")+e)};o(e.country),o(e.zip),o(e.city),o(e.street),o(e.building,"д."),o(e.suite,"корп."),o(e.flat,"кв."),o(e.entrance,"подъезд "),o(e.intercom,"домофон "),o(e.floor,"этаж "),o(e.metro,"метро "),i=i.substr(2),R.find("[name=address]").val(i)},n=window.open(e(this).attr("href"),"ya-order-popup","width=800,height=500,location=no,status=no,toolbar=no,menubar=no")}),R.on("shopDeliveryMethodSelected.NXCMS",o)),e(".shop-region-select").click(l),e(window).on("shopRegionChanged.NXCMS",c),A(),e(".shop-order-status-content .action-show-on-map").click(h),e(".shop-order-status-content .pay-button button").click($),U()});var H,q,z=["77000000000","Москва"],G="refresh",W={path:"/"};NXDATA.shopCookieDomain&&(W.domain=NXDATA.shopCookieDomain)}(jQuery),function(e){function t(){s=e('<form><p><b>Как Вы оцениваете данный товар?</b></p><div class="row"><div class="col-xs-5"><div class="form-group"><label>Общая оценка:</label><input name="score" class="star-control" type="hidden" value="0"></div></div><div class="col-xs-5"><div class="form-group"><label>Комфорт:</label><input name="score1" class="star-control" type="hidden" value="0"></div></div><div class="col-xs-5"><div class="form-group"><label>Стиль:</label><input name="score2" class="star-control" type="hidden" value="0"></div></div></div><div class="form-group"><label><b>Расскажите нам, что Вы думаете о данном товаре?</b></label><textarea name="text" class="form-control"></textarea></div><p><b>Расскажите немного о себе:</b></p><div class="form-group"><label>Имя <span class="dim">(не обязательно)</span>:</label><input name="author_name" type="text" class="form-control" style="width:40%;" maxlength="30"></div><div class="form-group"><label>Где Вы проживаете <span class="dim">(не обязательно)</span>:</label><input name="author_city" type="text" class="form-control" style="width:40%;" maxlength="30"></div><div class="form-group"><label>Электронная почта <span class="dim">(не обязательно)</span>:</label><input name="author_email" type="text" class="form-control" style="width:40%;"></div><button type="submit" class="btn btn-warning">Оставить отзыв</button></form>').appendTo(r).submit(n),e(".star-control").each(function(){function t(){var e=o.find("s"),t=e.slice(0,i),n=e.slice(i,5);t.addClass("h"),n.removeClass("h")}var n=e(this),i=parseInt(n.val(),10),o=e('<div class="star-control-stars"><s></s><s></s><s></s><s></s><s></s></div>').insertBefore(n);o.on("mouseover","s",function(){if(!n.is(":disabled")){var t=e(this);t.addClass("h").prevAll().addClass("h"),t.nextAll().removeClass("h")}}),o.mouseleave(t),o.on("click","s",function(){if(!n.is(":disabled")){var o=e(this);i=o.index()+1,t(),n.val(i).trigger("change")}}),t()})}function n(t){t.preventDefault();var n={page_id:NXDATA.pageId,text:e.trim(s.find("[name=text]").val()),author_name:e.trim(s.find("[name=author_name]").val()),author_email:e.trim(s.find("[name=author_email]").val()),author_city:e.trim(s.find("[name=author_city]").val()),score:parseInt(s.find("[name=score]").val()),score1:parseInt(s.find("[name=score1]").val()),score2:parseInt(s.find("[name=score2]").val())};if(n.text.length<10)return void e.notifier.error("Введите, пожалуйста, текст отзыва");s.find("button,input,textarea").attr("disabled",!0),e.ajax("/data/product-reviews",{type:"POST",data:JSON.stringify(n),contentType:"application/json",dataType:"json"}).done(function(t){s.html('<div class="alert alert-success">Ваш отзыв принят. Чтобы увидеть его, <a href="#" onclick="location.reload();return false;">обновите страницу</a>.</div>'),e("html,body").animate({scrollTop:s.offset().top-50},500),s=null}).fail(function(){e.notifier.error("Сбой соединения"),s.find("button,input,textarea").attr("disabled",!1)})}function i(t){t.preventDefault();var n=e(this),i=n.closest(".review"),o=i.data("review-id");n.attr("disabled",!0);var a={};e.ajax("/data/product-reviews/"+o+"/vote",{type:"POST",data:JSON.stringify(a),contentType:"application/json",dataType:"json"}).done(function(e){i.find(".vote").html(e.ok?"Ваш голос принят":"Вы уже голосовали за этот отзыв")}).fail(function(){e.notifier.error("Сбой соединения"),n.attr("disabled",!1)})}function o(t){t.preventDefault();var n=e(this),i=n.closest(".review"),o=i.data("review-id"),a={};e.ajax("/data/product-reviews/"+o+"/delete",{type:"POST",data:JSON.stringify(a),contentType:"application/json",dataType:"json"}).done(function(t){i.slideUp(200,function(){e(this).remove()})}).fail(function(){e.notifier.error("Сбой соединения")})}function a(t){function n(t,n){var o=parseInt(e(t).data("usefulness")),a=parseInt(e(n).data("usefulness"));return o>a?-1:o<a?1:i(t,n)}function i(t,n){var i=e(t).data("date"),o=e(n).data("date");return i>o?-1:i<o?1:0}var o=r.find(".reviews");t="string"==typeof t?t:e(this).data("sort-by"),o.children().sort("date"==t?i:n).appendTo(o),r.find("[data-sort-by]").each(function(){e(this).toggleClass("clickable",e(this).data("sort-by")!=t)})}("undefined"==typeof console||!1 in console)&&(window.console={log:function(){}});var r,s;e(function(){if(r=e(".reviews-section"),r.length&&NXDATA.pageId){var n=r.find(".review"),l=!1,c=e(".shop-product-price-block").data("product"),d=NXCMS.currentUserInRole("moderator");if(n.length){n.each(function(){var t=e(this);e('<div class="vote">Был ли полезен Вам отзыв? <button class="vote-for-review btn btn-default btn-sm">Да</button></div>').insertAfter(t.find(".rating")),d&&e('<div class="close del-review">&times;</div>').appendTo(t.find(".balloon"))});var u=r.find(".reviews");e('<div class="hdr"><button class="show-review-form pull-right btn btn-default">Оставить отзыв <span class="no-mobile">»</span></button><div class="sort">Сортировать: <span data-sort-by="usefulness">по полезности</span> | <span data-sort-by="date" class="clickable">по дате</span></div></div>').insertBefore(u),e('<div class="ftr">'+(c?'<a class="pull-left btn btn-default" href="/otzivy-o-tovare/'+c+'">Читать все отзывы</a>':"")+'<button class="show-review-form pull-right btn btn-default">Оставить отзыв <span class="no-mobile">»</span></button></div>').insertAfter(u),r.on("click",".show-review-form",function(){r.find(".show-review-form,.ftr").remove(),t(),e("html,body").animate({scrollTop:s.offset().top-50},500),l=!0}),e(".product-reviews-page").on("click",".show-review-form",function(){l||(r.find(".show-review-form,.ftr").remove(),t(),l=!0),e("html,body").animate({scrollTop:s.offset().top-50},500)}),r.on("click",".vote-for-review",i),r.on("click","[data-sort-by]",a),r.on("click",".del-review",o),a("usefulness")}else t()}e(".render-as-stars").each(function(){var t,n=e(this),i=parseInt(n.text()),o="";for(t=0;t<5;t++)o+=t<i?'<s class="h"></s>':"<s></s>";n.addClass("star-control-stars").html(o)})})}(jQuery),function(e){function t(){var t=[];return e(".shop-cart-content-form .product-thumb").each(function(){t.push({id:e(this).data("upid"),number:e(this).find('[name="qty"]').val()})}),t}function n(){s("9ce888757c",0)}function i(e){s("9ce888757b",1,e)}function o(e){s("9ce888757a",2,e)}function a(e){s("9ce8887579",3,e)}function r(e){s("9ce8887578",4,e)}function s(t,n,i){console.log("invoking admitad retag",n,i),e.extend(window,i),window._retag=[],window._retag.push({code:t,level:n}),function(){var e="admitad-retag",t=document.getElementById(e);t&&t.remove(),t=document.createElement("script"),t.async=!0,t.id=e;var n=(new Date).getDate();t.src=("https:"==document.location.protocol?"https:":"http:")+"//cdn.lenmit.com/static/js/retag.min.js?r="+n;var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(t,i)}()}("undefined"==typeof console||!1 in console)&&(window.console={log:function(){}}),e(function(){"/"==location.pathname?n():NXDATA&&NXDATA.shopProductId?o({ad_product:{id:NXDATA.shopProductId,category:NXDATA.shopCategoryId}}):NXDATA&&NXDATA.shopCategoryId?i({ad_category:NXDATA.shopCategoryId}):"/cart"==location.pathname&&(a({ad_products:t()}),e(window).on("orderConfirmed.NXCMS",function(e,n){try{r({ad_products:t(),ad_order:n._id,ad_amount:n.total})}catch(e){console.log("admitad retag error",e)}}))})}(jQuery);